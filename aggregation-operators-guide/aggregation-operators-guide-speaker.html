<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #1e1e1e;
            color: #ffffff;
            line-height: 1.6;
        }
        
        .slide {
            min-height: 100vh;
            padding: 40px;
            box-sizing: border-box;
            position: relative;
        }
        
        .slide-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 0.5em;
            color: #61dafb;
        }
        
        h2 {
            font-size: 2em;
            margin-bottom: 0.5em;
            color: #61dafb;
        }
        
        h3 {
            font-size: 1.5em;
            margin-bottom: 0.5em;
            color: #61dafb;
        }
        
        p {
            font-size: 1.2em;
            margin-bottom: 1em;
        }
        
        ul, ol {
            font-size: 1.1em;
            margin-bottom: 1em;
        }
        
        li {
            margin-bottom: 0.5em;
        }
        
        code {
            background: #2d2d2d;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        
        pre {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        /* Notes Section */
        .notes-section {
            margin-top: 30px;
            border-top: 2px solid #61dafb;
            padding-top: 20px;
        }
        
        .notes-toggle {
            background: #61dafb;
            color: #1e1e1e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .notes-toggle:hover {
            background: #4fa8c5;
        }
        
        .notes-content {
            display: none;
            background: #2d2d2d;
            border: 1px solid #61dafb;
            border-radius: 8px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        .notes-content.show {
            display: block;
        }
        
        .notes-content h4 {
            color: #61dafb;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        /* Slide Navigation */
        .slide-nav {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(30, 30, 30, 0.9);
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
        }
        
        .slide-nav button {
            background: #61dafb;
            color: #1e1e1e;
            border: none;
            padding: 5px 10px;
            margin: 0 2px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .slide-nav button:hover {
            background: #4fa8c5;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .slide {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            h2 {
                font-size: 1.5em;
            }
            
            .slide-nav {
                position: static;
                text-align: center;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="slide-nav">
        <button onclick="previousSlide()">‚Üê</button>
        <span id="slide-counter">1</span>
        <button onclick="nextSlide()">‚Üí</button>
    </div>
    
    <div id="slides-container">
        <h1 id="mongodb-aggregation-operators-performance-guide">üìä
        MongoDB Aggregation Operators Performance Guide</h1>
        <h2
        id="complete-pipeline-operator-reference-performance-optimization">Complete
        Pipeline Operator Reference &amp; Performance Optimization</h2>
        <p><em>Deep dive into every aggregation operator: performance,
        patterns, and production optimization</em></p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="complete-operator-coverage">üéØ Complete Operator
        Coverage</h1>
        <p><strong>Target Audience:</strong> Node.js &amp; Mongoose
        developers (all levels) <strong>Duration:</strong> ~90-120
        minutes<br />
        <strong>Format:</strong> Comprehensive operator-by-operator
        performance analysis</p>
        <h2 id="what-makes-this-guide-complete">What Makes This Guide
        Complete</h2>
        <ul>
        <li><strong>40+ Pipeline Operators</strong> with performance
        characteristics</li>
        <li><strong>Real-world optimization patterns</strong> for each
        operator</li>
        <li><strong>Version-specific improvements</strong> across
        MongoDB 6, 7, and 8</li>
        <li><strong>Production anti-patterns</strong> and memory
        management</li>
        <li><strong>Complete operator reference</strong> with
        performance benchmarks</li>
        </ul>
        <div class="notes">
        <p><strong>Scope Emphasis:</strong> ‚ÄúThis isn‚Äôt just about
        $match, $group, and $sort. We‚Äôre covering operators most
        developers have never used but that can solve complex problems
        elegantly.‚Äù</p>
        <p><strong>Show Slide List:</strong> Briefly scroll through the
        operator categories to show the breadth.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="complete-operator-reference">üìã Complete Operator
        Reference</h1>
        <h2 id="core-pipeline-operators-high-impact">Core Pipeline
        Operators (High-Impact)</h2>
        <p><strong>Filtering &amp; Matching:</strong>
        <code>$match</code>, <code>$redact</code>, <code>$filter</code>
        <strong>Joining &amp; Lookups:</strong> <code>$lookup</code>,
        <code>$graphLookup</code>, <code>$unionWith</code>
        <strong>Grouping &amp; Aggregation:</strong>
        <code>$group</code>, <code>$bucket</code>,
        <code>$bucketAuto</code>, <code>$count</code> <strong>Sorting
        &amp; Limiting:</strong> <code>$sort</code>,
        <code>$limit</code>, <code>$skip</code>, <code>$sample</code>
        <strong>Document Transformation:</strong> <code>$project</code>,
        <code>$addFields</code>, <code>$set</code>, <code>$unset</code>,
        <code>$replaceRoot</code>, <code>$replaceWith</code></p>
        <h2 id="advanced-pipeline-operators">Advanced Pipeline
        Operators</h2>
        <p><strong>Array Processing:</strong> <code>$unwind</code>,
        <code>$sortArray</code>, <code>$slice</code>
        <strong>Multi-Pipeline:</strong> <code>$facet</code>,
        <code>$lookup</code> (with pipeline) <strong>Window
        Functions:</strong> <code>$setWindowFields</code>,
        <code>$densify</code>, <code>$fill</code>
        <strong>Geospatial:</strong> <code>$geoNear</code>,
        <code>$geoWithin</code> <strong>Text &amp; Search:</strong>
        <code>$search</code>, <code>$searchMeta</code> (Atlas only)
        <strong>Output Operations:</strong> <code>$out</code>,
        <code>$merge</code></p>
        <div class="notes">
        <p><strong>Organization Logic:</strong> ‚ÄúI‚Äôve organized these by
        impact and usage patterns. Core operators are your daily
        drivers, advanced operators solve specific problems.‚Äù</p>
        <p><strong>Learning Path:</strong> ‚ÄúStart with core, then add
        advanced operators as your use cases demand them.‚Äù</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="aggregation-pipeline-architecture-deep-dive">üèóÔ∏è
        Aggregation Pipeline Architecture Deep Dive</h1>
        <h2 id="how-mongodb-processes-every-operator">How MongoDB
        Processes Every Operator</h2>
        <div class="sourceCode" id="cb1"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Complete pipeline example with multiple operator types</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">sales</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$match</span><span class="op">:</span> { <span class="dt">date</span><span class="op">:</span> { <span class="dt">$gte</span><span class="op">:</span> <span class="fu">ISODate</span>(<span class="st">&quot;2024-01-01&quot;</span>) } } }<span class="op">,</span>           <span class="co">// FILTER</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$addFields</span><span class="op">:</span> { <span class="dt">quarter</span><span class="op">:</span> { <span class="dt">$quarter</span><span class="op">:</span> <span class="st">&quot;$date&quot;</span> } } }<span class="op">,</span>              <span class="co">// TRANSFORM</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$lookup</span><span class="op">:</span> { <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;products&quot;</span><span class="op">,</span> <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;productId&quot;</span><span class="op">,</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span> <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;product&quot;</span> } }<span class="op">,</span>              <span class="co">// JOIN</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$product&quot;</span> }<span class="op">,</span>                                         <span class="co">// ARRAY</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$replaceRoot</span><span class="op">:</span> { <span class="dt">newRoot</span><span class="op">:</span> { <span class="dt">$mergeObjects</span><span class="op">:</span> [<span class="st">&quot;$$ROOT&quot;</span><span class="op">,</span> <span class="st">&quot;$product&quot;</span>] } } }<span class="op">,</span> <span class="co">// RESHAPE</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$bucket</span><span class="op">:</span> { <span class="dt">groupBy</span><span class="op">:</span> <span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="dt">boundaries</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">1000</span>] } }<span class="op">,</span>     <span class="co">// BUCKET</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$facet</span><span class="op">:</span> {                                                      <span class="co">// MULTI-PIPELINE</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;priceAnalysis&quot;</span><span class="op">:</span> [{ <span class="dt">$group</span><span class="op">:</span> { <span class="dt">_id</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">avgPrice</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$price&quot;</span> } } }]<span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;categoryBreakdown&quot;</span><span class="op">:</span> [{ <span class="dt">$group</span><span class="op">:</span> { <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$category&quot;</span><span class="op">,</span> <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> } } }]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  }}<span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$project</span><span class="op">:</span> { <span class="dt">analysis</span><span class="op">:</span> { <span class="dt">$concatArrays</span><span class="op">:</span> [<span class="st">&quot;$priceAnalysis&quot;</span><span class="op">,</span> <span class="st">&quot;$categoryBreakdown&quot;</span>] } } }<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">$out</span><span class="op">:</span> <span class="st">&quot;quarterly_sales_analysis&quot;</span> }                             <span class="co">// OUTPUT</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Each operator type has different performance characteristics!</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Visual Teaching<span class="op">:**</span> Draw the pipeline flow on whiteboard <span class="cf">if</span> possible<span class="op">.</span> <span class="st">&quot;Each operator type affects memory and performance differently.&quot;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Insight<span class="op">:**</span> <span class="st">&quot;Understanding the distinction between streaming and blocking operations is crucial for memory management.&quot;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a># üèóÔ∏è Aggregation Pipeline Architecture Deep <span class="fu">Dive</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="core-performance-principles-by-operator-type">‚ö° Core
        Performance Principles by Operator Type</h1>
        <h2 id="streaming-vs.-blocking-operations">Streaming
        vs.¬†Blocking Operations</h2>
        <h3 id="streaming-operations-memory-efficient">üåä
        <strong>Streaming Operations</strong> (Memory-Efficient)</h3>
        <div class="sourceCode" id="cb2"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// These process documents one-by-one:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$match</span><span class="op">:</span> { <span class="op">...</span> } }        <span class="co">// Filters as documents flow through</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$project</span><span class="op">:</span> { <span class="op">...</span> } }      <span class="co">// Transforms individual documents  </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$addFields</span><span class="op">:</span> { <span class="op">...</span> } }    <span class="co">// Adds fields to each document</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$set</span><span class="op">:</span> { <span class="op">...</span> } }          <span class="co">// Sets fields on each document</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$unset</span><span class="op">:</span> [<span class="st">&quot;field&quot;</span>] }      <span class="co">// Removes fields from each document</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$limit</span><span class="op">:</span> <span class="dv">100</span> }            <span class="co">// Stops after N documents</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$skip</span><span class="op">:</span> <span class="dv">50</span> }              <span class="co">// Skips N documents</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$replaceRoot</span><span class="op">:</span> { <span class="op">...</span> } }  <span class="co">// Transforms document structure</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a># ‚ö° Core <span class="bu">Performance</span> Principles by Operator <span class="fu">Type</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <h3 id="blocking-operations-memory-intensive">üîí
        <strong>Blocking Operations</strong> (Memory-Intensive)</h3>
        <div class="sourceCode" id="cb3"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// These must collect/process all documents:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$sort</span><span class="op">:</span> { <span class="op">...</span> } }         <span class="co">// Must see all documents to sort</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$group</span><span class="op">:</span> { <span class="op">...</span> } }        <span class="co">// Accumulates across all documents</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$bucket</span><span class="op">:</span> { <span class="op">...</span> } }       <span class="co">// Distributes documents into buckets</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$facet</span><span class="op">:</span> { <span class="op">...</span> } }        <span class="co">// Runs multiple pipelines in parallel</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$lookup</span><span class="op">:</span> { <span class="op">...</span> } }       <span class="co">// Joins require index scanning</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$out</span><span class="op">:</span> <span class="st">&quot;collection&quot;</span> }     <span class="co">// Writes all results to output</span></span></code></pre></div>
        <p><strong>Key Insight:</strong> Minimize blocking operations
        and optimize their data input size</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="match-the-performance-foundation">üîç $match: The
        Performance Foundation</h1>
        <h2 id="advanced-match-optimization-patterns">Advanced $match
        Optimization Patterns</h2>
        <h3 id="multi-field-index-optimization">‚úÖ Multi-Field Index
        Optimization</h3>
        <div class="sourceCode" id="cb4"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EXCELLENT: Compound index utilization</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Index: { status: 1, category: 1, price: 1, date: 1 }</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$match</span><span class="op">:</span> {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">status</span><span class="op">:</span> <span class="st">&quot;active&quot;</span><span class="op">,</span>                    <span class="co">// Equality (uses index)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">category</span><span class="op">:</span> { <span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;electronics&quot;</span><span class="op">,</span> <span class="st">&quot;books&quot;</span>] }<span class="op">,</span> <span class="co">// Range (uses index)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> { <span class="dt">$gte</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">$lte</span><span class="op">:</span> <span class="dv">1000</span> }<span class="op">,</span>   <span class="co">// Range (uses index)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span><span class="op">:</span> { <span class="dt">$gte</span><span class="op">:</span> <span class="fu">ISODate</span>(<span class="st">&quot;2024-01-01&quot;</span>) } <span class="co">// Range (uses index)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance: Index scan of ~1000 docs instead of collection scan of 10M</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Fundamental Truth<span class="op">:**</span> <span class="st">&quot;$match is the foundation of every performant pipeline. Get this wrong and everything downstream suffers.&quot;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="op">**</span><span class="bu">Index</span> Strategy<span class="op">:**</span> Emphasize that $match optimization is really about index optimization<span class="op">.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a># üîç $match<span class="op">:</span> The <span class="bu">Performance</span> <span class="fu">Foundation</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="complex-expression-anti-patterns">‚ùå Complex Expression
        Anti-Patterns</h3>
        <div class="sourceCode" id="cb5"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: $expr prevents index usage</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$match</span><span class="op">:</span> { </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">$expr</span><span class="op">:</span> { <span class="dt">$gt</span><span class="op">:</span> [{ <span class="dt">$multiply</span><span class="op">:</span> [<span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="st">&quot;$quantity&quot;</span>] }<span class="op">,</span> <span class="dv">1000</span>] }</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Result: Collection scan of entire dataset</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Pre-compute or restructure</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$addFields</span><span class="op">:</span> { <span class="dt">totalValue</span><span class="op">:</span> { <span class="dt">$multiply</span><span class="op">:</span> [<span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="st">&quot;$quantity&quot;</span>] } } }<span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$match</span><span class="op">:</span> { <span class="dt">totalValue</span><span class="op">:</span> { <span class="dt">$gt</span><span class="op">:</span> <span class="dv">1000</span> } } }</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Or even better: compute totalValue at insert time with index</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a># üîç $match<span class="op">:</span> The <span class="bu">Performance</span> <span class="fu">Foundation</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="project-field-selection-transformation">üìÑ $project:
        Field Selection &amp; Transformation</h1>
        <h2 id="understanding-project-performance-impact">Understanding
        $project Performance Impact</h2>
        <h3 id="memory-network-optimization">Memory &amp; Network
        Optimization</h3>
        <div class="sourceCode" id="cb6"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Document size impact on pipeline performance:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">// BEFORE: Large documents (5KB each)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$project</span><span class="op">:</span> { </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">description</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">reviews</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">metadata</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">images</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">specifications</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">inventory</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">// 10K docs √ó 5KB = 50MB pipeline memory</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">// AFTER: Minimal projection (500B each)  </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$project</span><span class="op">:</span> { <span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">_id</span><span class="op">:</span> <span class="dv">0</span> } }</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">// 10K docs √ó 500B = 5MB pipeline memory (10x improvement)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Memory Mathematics<span class="op">:**</span> <span class="st">&quot;Document size directly impacts memory usage throughout your pipeline. A 5KB document vs 500B makes a 10x difference in memory.&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Network Efficiency<span class="op">:**</span> <span class="st">&quot;Smaller documents also mean faster network transfer, especially in sharded environments.&quot;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a># üìÑ $project<span class="op">:</span> Field Selection <span class="op">&amp;</span> <span class="fu">Transformation</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="advanced-project-patterns">Advanced $project
        Patterns</h3>
        <div class="sourceCode" id="cb7"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EXCELLENT: Computed fields for later stages</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$project</span><span class="op">:</span> {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">discountedPrice</span><span class="op">:</span> { <span class="dt">$multiply</span><span class="op">:</span> [<span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="fl">0.9</span>] }<span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">priceRange</span><span class="op">:</span> {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$switch</span><span class="op">:</span> {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">branches</span><span class="op">:</span> [</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">case</span><span class="op">:</span> { <span class="dt">$lt</span><span class="op">:</span> [<span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="dv">50</span>] }<span class="op">,</span> <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;budget&quot;</span> }<span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">case</span><span class="op">:</span> { <span class="dt">$lt</span><span class="op">:</span> [<span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="dv">200</span>] }<span class="op">,</span> <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;mid-range&quot;</span> }</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span> <span class="st">&quot;premium&quot;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Nested field extraction</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;address.city&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;address.country&quot;</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a># üìÑ $project<span class="op">:</span> Field Selection <span class="op">&amp;</span> <span class="fu">Transformation</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="addfields-set-unset-document-enhancement">‚ûï $addFields,
        $set, $unset: Document Enhancement</h1>
        <h1 id="addfields-set-unset-document-enhancement-1">‚ûï
        $addFields, $set, $unset: Document Enhancement</h1>
        <h2
        id="performance-optimized-field-operations">Performance-Optimized
        Field Operations</h2>
        <h3 id="addfields-vs-set-identical-performance">$addFields vs
        $set (Identical Performance)</h3>
        <div class="sourceCode" id="cb8"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// These are equivalent in MongoDB 4.2+:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$addFields</span><span class="op">:</span> { <span class="dt">computedField</span><span class="op">:</span> { <span class="dt">$add</span><span class="op">:</span> [<span class="st">&quot;$field1&quot;</span><span class="op">,</span> <span class="st">&quot;$field2&quot;</span>] } } }</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$set</span><span class="op">:</span> { <span class="dt">computedField</span><span class="op">:</span> { <span class="dt">$add</span><span class="op">:</span> [<span class="st">&quot;$field1&quot;</span><span class="op">,</span> <span class="st">&quot;$field2&quot;</span>] } } }</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Adding computed fields for later pipeline stages</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$addFields</span><span class="op">:</span> {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fullName</span><span class="op">:</span> { <span class="dt">$concat</span><span class="op">:</span> [<span class="st">&quot;$firstName&quot;</span><span class="op">,</span> <span class="st">&quot; &quot;</span><span class="op">,</span> <span class="st">&quot;$lastName&quot;</span>] }<span class="op">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ageGroup</span><span class="op">:</span> {</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$switch</span><span class="op">:</span> {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">branches</span><span class="op">:</span> [</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">case</span><span class="op">:</span> { <span class="dt">$lt</span><span class="op">:</span> [<span class="st">&quot;$age&quot;</span><span class="op">,</span> <span class="dv">18</span>] }<span class="op">,</span> <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;minor&quot;</span> }<span class="op">,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">case</span><span class="op">:</span> { <span class="dt">$lt</span><span class="op">:</span> [<span class="st">&quot;$age&quot;</span><span class="op">,</span> <span class="dv">65</span>] }<span class="op">,</span> <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;adult&quot;</span> }</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span> <span class="st">&quot;senior&quot;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Extract date components for grouping</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> { <span class="dt">$year</span><span class="op">:</span> <span class="st">&quot;$createdAt&quot;</span> }<span class="op">,</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">month</span><span class="op">:</span> { <span class="dt">$month</span><span class="op">:</span> <span class="st">&quot;$createdAt&quot;</span> }</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Use Case Distinction<span class="op">:**</span> <span class="st">&quot;Use $addFields when you want to keep existing fields, $project when you want to be selective.&quot;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Pipeline <span class="bu">Position</span><span class="op">:**</span> <span class="st">&quot;Add expensive computed fields AFTER filtering to minimize computation.&quot;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a># ‚ûï $addFields<span class="op">,</span> $set<span class="op">,</span> $unset<span class="op">:</span> <span class="bu">Document</span> <span class="fu">Enhancement</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <h3 id="addfields-anti-patterns">‚ùå $addFields
        Anti-Patterns</h3>
        <div class="sourceCode" id="cb9"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Expensive operations early in pipeline</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$addFields</span><span class="op">:</span> {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Complex regex operations on large text fields</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extractedData</span><span class="op">:</span> { <span class="dt">$regexFindAll</span><span class="op">:</span> { <span class="dt">input</span><span class="op">:</span> <span class="st">&quot;$largeTextField&quot;</span><span class="op">,</span> <span class="dt">regex</span><span class="op">:</span> <span class="ss">/complex-pattern/g</span> } }<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Heavy array processing</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">processedItems</span><span class="op">:</span> { <span class="dt">$map</span><span class="op">:</span> { <span class="dt">input</span><span class="op">:</span> <span class="st">&quot;$largeArray&quot;</span><span class="op">,</span> <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;item&quot;</span><span class="op">,</span> <span class="kw">in</span><span class="op">:</span> { <span class="co">/* complex logic */</span> } } }</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply these AFTER filtering reduces dataset size!</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Add expensive computed fields after filtering</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$match</span><span class="op">:</span> { <span class="dt">category</span><span class="op">:</span> <span class="st">&quot;relevant&quot;</span> } }<span class="op">,</span>        <span class="co">// Reduce dataset first</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$addFields</span><span class="op">:</span> { <span class="co">/* expensive computations */</span> } }</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="replaceroot-replacewith-document-restructuring">üîÑ
        $replaceRoot &amp; $replaceWith: Document Restructuring</h1>
        <h2 id="advanced-document-transformation-patterns">Advanced
        Document Transformation Patterns</h2>
        <h3
        id="performance-optimized-document-reshaping">Performance-Optimized
        Document Reshaping</h3>
        <div class="sourceCode" id="cb10"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EXCELLENT: Flatten nested structures efficiently</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$replaceRoot</span><span class="op">:</span> { </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">newRoot</span><span class="op">:</span> { </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$mergeObjects</span><span class="op">:</span> [</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$_id&quot;</span><span class="op">,</span> <span class="dt">timestamp</span><span class="op">:</span> <span class="st">&quot;$timestamp&quot;</span> }<span class="op">,</span>  <span class="co">// Keep metadata</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;$userData&quot;</span><span class="op">,</span>                                <span class="co">// Promote nested object</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">source</span><span class="op">:</span> <span class="st">&quot;aggregation&quot;</span> }                  <span class="co">// Add new fields</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">// PERFORMANCE TIP: $replaceRoot is streaming - very memory efficient</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Processes one document at a time, no accumulation required</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a># üîÑ $replaceRoot <span class="op">&amp;</span> $replaceWith<span class="op">:</span> <span class="bu">Document</span> <span class="fu">Restructuring</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="common-replaceroot-use-cases">Common $replaceRoot Use
        Cases</h3>
        <div class="sourceCode" id="cb11"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Promote nested objects to root level</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$replaceRoot</span><span class="op">:</span> { <span class="dt">newRoot</span><span class="op">:</span> <span class="st">&quot;$nestedDocument&quot;</span> } }</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Merge multiple objects</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$replaceRoot</span><span class="op">:</span> { </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">newRoot</span><span class="op">:</span> { <span class="dt">$mergeObjects</span><span class="op">:</span> [<span class="st">&quot;$user&quot;</span><span class="op">,</span> <span class="st">&quot;$profile&quot;</span><span class="op">,</span> <span class="st">&quot;$settings&quot;</span>] }</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Create entirely new document structure</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$replaceRoot</span><span class="op">:</span> {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">newRoot</span><span class="op">:</span> {</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;$_id&quot;</span><span class="op">,</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">summary</span><span class="op">:</span> {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> { <span class="dt">$concat</span><span class="op">:</span> [<span class="st">&quot;$firstName&quot;</span><span class="op">,</span> <span class="st">&quot; &quot;</span><span class="op">,</span> <span class="st">&quot;$lastName&quot;</span>] }<span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">contact</span><span class="op">:</span> { <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;$email&quot;</span><span class="op">,</span> <span class="dt">phone</span><span class="op">:</span> <span class="st">&quot;$phone&quot;</span> }<span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">stats</span><span class="op">:</span> { <span class="dt">totalOrders</span><span class="op">:</span> <span class="st">&quot;$orderCount&quot;</span><span class="op">,</span> <span class="dt">lastOrder</span><span class="op">:</span> <span class="st">&quot;$lastOrderDate&quot;</span> }</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Transformation Power<span class="op">:**</span> <span class="st">&quot;This is one of the most powerful but underused operators. Perfect for flattening complex nested structures.&quot;</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Memory Efficiency<span class="op">:**</span> <span class="st">&quot;It&#39;s streaming, so very memory efficient even with large datasets.&quot;</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a># üîÑ $replaceRoot <span class="op">&amp;</span> $replaceWith<span class="op">:</span> <span class="bu">Document</span> <span class="fu">Restructuring</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="group-advanced-aggregation-patterns">üóÇÔ∏è $group: Advanced
        Aggregation Patterns</h1>
        <h2 id="memory-efficient-grouping-strategies">Memory-Efficient
        Grouping Strategies</h2>
        <h3 id="understanding-group-memory-consumption">Understanding
        $group Memory Consumption</h3>
        <div class="sourceCode" id="cb12"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory usage factors:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Number of unique group keys (most important!)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Size of accumulated values</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Types of accumulators used</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">// LOW MEMORY: Few groups, simple accumulators</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$status&quot;</span><span class="op">,</span>                    <span class="co">// ~5 unique values</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span>               <span class="co">// Integer accumulator</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">avgAmount</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span> }    <span class="co">// Number accumulator</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory usage: ~1KB for group state</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">// HIGH MEMORY: Many groups, complex accumulators  </span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> { </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">user</span><span class="op">:</span> <span class="st">&quot;$userId&quot;</span><span class="op">,</span>              <span class="co">// 100K unique users</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">product</span><span class="op">:</span> <span class="st">&quot;$productId&quot;</span><span class="op">,</span>        <span class="co">// 10K unique products  </span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">day</span><span class="op">:</span> { <span class="dt">$dateToString</span><span class="op">:</span> { <span class="dt">format</span><span class="op">:</span> <span class="st">&quot;%Y-%m-%d&quot;</span><span class="op">,</span> <span class="dt">date</span><span class="op">:</span> <span class="st">&quot;$date&quot;</span> } }</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">purchases</span><span class="op">:</span> { <span class="dt">$push</span><span class="op">:</span> <span class="st">&quot;$$ROOT&quot;</span> }<span class="op">,</span>   <span class="co">// Accumulates full documents!</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uniqueCategories</span><span class="op">:</span> { <span class="dt">$addToSet</span><span class="op">:</span> <span class="st">&quot;$category&quot;</span> }</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory usage: Potentially 10GB+ with large datasets!</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a># üóÇÔ∏è $group<span class="op">:</span> Advanced Aggregation <span class="fu">Patterns</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Memory Mathematics:</strong> ‚ÄúGroup cardinality is
        the biggest factor in memory usage. 1000 groups = manageable. 1
        million groups = disaster.‚Äù</p>
        <p><strong>Accumulator Strategy:</strong> ‚ÄúSimple accumulators
        like $sum are cheap. Array accumulators like $push can be
        expensive.‚Äù</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="advanced-group-accumulators-performance">üßÆ Advanced
        $group Accumulators &amp; Performance</h1>
        <h2 id="mongodb-6.0-new-performance-operators">MongoDB 6.0+ New
        Performance Operators</h2>
        <h3 id="topn-bottomn-firstn-lastn-mongodb-6.0">$topN, $bottomN,
        $firstN, $lastN (MongoDB 6.0+)</h3>
        <div class="sourceCode" id="cb13"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EXCELLENT: Replaces expensive $sort + $limit patterns</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD WAY (memory-intensive):</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$group</span><span class="op">:</span> { <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$category&quot;</span><span class="op">,</span> <span class="dt">products</span><span class="op">:</span> { <span class="dt">$push</span><span class="op">:</span> <span class="st">&quot;$$ROOT&quot;</span> } } }<span class="op">,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$project</span><span class="op">:</span> { </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">topProducts</span><span class="op">:</span> { </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$slice</span><span class="op">:</span> [{ <span class="dt">$sortArray</span><span class="op">:</span> { <span class="dt">input</span><span class="op">:</span> <span class="st">&quot;$products&quot;</span><span class="op">,</span> <span class="dt">sortBy</span><span class="op">:</span> { <span class="dt">sales</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } } }<span class="op">,</span> <span class="dv">5</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW WAY (MongoDB 6.0+, much more efficient):</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$category&quot;</span><span class="op">,</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">topProducts</span><span class="op">:</span> { </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$topN</span><span class="op">:</span> { </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">output</span><span class="op">:</span> <span class="st">&quot;$$ROOT&quot;</span><span class="op">,</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">sortBy</span><span class="op">:</span> { <span class="dt">sales</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> }<span class="op">,</span> </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">n</span><span class="op">:</span> <span class="dv">5</span> </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bottomPrices</span><span class="op">:</span> {</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$bottomN</span><span class="op">:</span> { </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">output</span><span class="op">:</span> <span class="st">&quot;$price&quot;</span><span class="op">,</span> </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">sortBy</span><span class="op">:</span> { <span class="dt">price</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span> </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">n</span><span class="op">:</span> <span class="dv">3</span> </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory usage: Maintains only top N items instead of all items</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a># üßÆ Advanced $group Accumulators <span class="op">&amp;</span> <span class="bu">Performance</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <h3 id="window-functions-with-setwindowfields">Window Functions
        with $setWindowFields</h3>
        <div class="sourceCode" id="cb14"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// POWERFUL: Advanced analytics without complex grouping</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$setWindowFields</span><span class="op">:</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">partitionBy</span><span class="op">:</span> <span class="st">&quot;$category&quot;</span><span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sortBy</span><span class="op">:</span> { <span class="dt">date</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">runningTotal</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span><span class="op">,</span> <span class="dt">window</span><span class="op">:</span> { <span class="dt">documents</span><span class="op">:</span> [<span class="st">&quot;unbounded&quot;</span><span class="op">,</span> <span class="st">&quot;current&quot;</span>] } }<span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">movingAverage</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span><span class="op">,</span> <span class="dt">window</span><span class="op">:</span> { <span class="dt">documents</span><span class="op">:</span> [<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span>] } }<span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rank</span><span class="op">:</span> { <span class="dt">$rank</span><span class="op">:</span> {} }<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">lag</span><span class="op">:</span> { <span class="dt">$shift</span><span class="op">:</span> { <span class="dt">output</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span><span class="op">,</span> <span class="dt">by</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>}}</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="lookup-performance-risks-mitigation-strategies">üîó
        $lookup: Performance Risks &amp; Mitigation Strategies</h1>
        <h2 id="critical-lookup-performance-warnings">Critical $lookup
        Performance Warnings</h2>
        <h3 id="collection-size-performance-degradation">Collection Size
        Performance Degradation</h3>
        <div class="sourceCode" id="cb15"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ‚ö†Ô∏è </span><span class="al">WARNING</span><span class="co">: $lookup performance degrades dramatically with scale</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">// SMALL: Both collections &lt; 10K documents - ONLY SAFE SCENARIO</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$lookup</span><span class="op">:</span> { <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;products&quot;</span><span class="op">,</span> <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;productId&quot;</span><span class="op">,</span> <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span> } }</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance: ~10-50ms ‚úÖ (Acceptable but still avoid if possible)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">// MEDIUM: &quot;from&quot; collection 100K - 1M documents - </span><span class="al">DANGER</span><span class="co"> ZONE</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$lookup</span><span class="op">:</span> { <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;large_catalog&quot;</span><span class="op">,</span> <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;productId&quot;</span><span class="op">,</span> <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;sku&quot;</span> } }</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance: ~200-2000ms ‚ùå (Major performance regression)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">// LARGE: &quot;from&quot; collection 5M+ documents - PRODUCTION KILLER</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$lookup</span><span class="op">:</span> { <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;massive_inventory&quot;</span><span class="op">,</span> <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;productId&quot;</span><span class="op">,</span> <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;code&quot;</span> } }</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance: ~10-60 seconds ‚ùå (System-breaking, causes timeouts)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">// The exponential scaling problem:</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">// N documents √ó M lookup candidates = N√óM comparison operations</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">// 1K √ó 10M = 10 billion comparisons - AVOID AT ALL COSTS!</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a># üîó $lookup<span class="op">:</span> <span class="bu">Performance</span> Risks <span class="op">&amp;</span> Mitigation <span class="fu">Strategies</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3
        id="emergency-lookup-mitigation-when-absolutely-unavoidable">Emergency
        $lookup Mitigation (When Absolutely Unavoidable)</h3>
        <h4 id="last-resort-pipeline-based-damage-control">Last Resort:
        Pipeline-Based Damage Control</h4>
        <div class="sourceCode" id="cb16"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EMERGENCY ONLY: If you MUST use $lookup, minimize damage with pre-filtering</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$lookup</span><span class="op">:</span> {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;products&quot;</span><span class="op">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">let</span><span class="op">:</span> { <span class="dt">productId</span><span class="op">:</span> <span class="st">&quot;$productId&quot;</span><span class="op">,</span> <span class="dt">minRating</span><span class="op">:</span> <span class="fl">4.0</span> }<span class="op">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pipeline</span><span class="op">:</span> [</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$match</span><span class="op">:</span> { </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">active</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>                    <span class="co">// Filter first! (indexed)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">category</span><span class="op">:</span> <span class="st">&quot;electronics&quot;</span>          <span class="co">// Further filter (indexed)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        }}<span class="op">,</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$match</span><span class="op">:</span> { </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$expr</span><span class="op">:</span> { </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$and</span><span class="op">:</span> [</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                    { <span class="dt">$eq</span><span class="op">:</span> [<span class="st">&quot;$_id&quot;</span><span class="op">,</span> <span class="st">&quot;$$productId&quot;</span>] }<span class="op">,</span>      <span class="co">// Join condition</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                    { <span class="dt">$gte</span><span class="op">:</span> [<span class="st">&quot;$rating&quot;</span><span class="op">,</span> <span class="st">&quot;$$minRating&quot;</span>] }   <span class="co">// Additional filter</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        }}<span class="op">,</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$project</span><span class="op">:</span> { <span class="dt">name</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">rating</span><span class="op">:</span> <span class="dv">1</span> } }    <span class="co">// Limit fields</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;productInfo&quot;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Required indexes:</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">// products: { active: 1, category: 1, _id: 1 }</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">// products: { rating: 1 }</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Scale Reality Check<span class="op">:**</span> <span class="st">&quot;This is where I see the most production issues. What works with 1000 documents fails spectacularly with 1 million.&quot;</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Critical Decision<span class="op">:**</span> <span class="st">&quot;Denormalization or application-level joins are almost always better than $lookup. Avoid $lookup unless absolutely no other option exists.&quot;</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a># üîó $lookup<span class="op">:</span> <span class="bu">Performance</span> Risks <span class="op">&amp;</span> Mitigation <span class="fu">Strategies</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="graphlookup-recursive-relationship-performance">üåê
        $graphLookup: Recursive Relationship Performance</h1>
        <h2 id="optimizing-hierarchical-data-traversal">Optimizing
        Hierarchical Data Traversal</h2>
        <h3 id="graphlookup-performance-characteristics">$graphLookup
        Performance Characteristics</h3>
        <div class="sourceCode" id="cb17"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// $graphLookup performance depends on:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Tree depth (exponential impact)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Branching factor (how many children per node)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Index on connectFromField</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. maxDepth limitation</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Limited depth, well-indexed</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$graphLookup</span><span class="op">:</span> {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;employees&quot;</span><span class="op">,</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">startWith</span><span class="op">:</span> <span class="st">&quot;$managerId&quot;</span><span class="op">,</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">connectFromField</span><span class="op">:</span> <span class="st">&quot;managerId&quot;</span><span class="op">,</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">connectToField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span>           <span class="co">// MUST be indexed!</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;reportingChain&quot;</span><span class="op">,</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxDepth</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span>                     <span class="co">// Limit depth!</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">depthField</span><span class="op">:</span> <span class="st">&quot;level&quot;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Index requirement: { _id: 1 } (automatic) + { managerId: 1 }</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a># üåê $graphLookup<span class="op">:</span> Recursive Relationship <span class="bu">Performance</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="graphlookup-memory-management">$graphLookup Memory
        Management</h3>
        <div class="sourceCode" id="cb18"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Unlimited depth traversal</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$graphLookup</span><span class="op">:</span> {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;network_nodes&quot;</span><span class="op">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">startWith</span><span class="op">:</span> <span class="st">&quot;$connectedNodes&quot;</span><span class="op">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">connectFromField</span><span class="op">:</span> <span class="st">&quot;connectedNodes&quot;</span><span class="op">,</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">connectToField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;fullNetwork&quot;</span>              <span class="co">// Could traverse millions of nodes!</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Bounded traversal with filtering</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$graphLookup</span><span class="op">:</span> {</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;network_nodes&quot;</span><span class="op">,</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">startWith</span><span class="op">:</span> <span class="st">&quot;$connectedNodes&quot;</span><span class="op">,</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">connectFromField</span><span class="op">:</span> <span class="st">&quot;connectedNodes&quot;</span><span class="op">,</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">connectToField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span> </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;nearbyNetwork&quot;</span><span class="op">,</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxDepth</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span>                   <span class="co">// Limit traversal depth</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">restrictSearchWithMatch</span><span class="op">:</span> {      <span class="co">// Filter during traversal</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">active</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">region</span><span class="op">:</span> <span class="st">&quot;US-WEST&quot;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Recursive Reality<span class="op">:**</span> <span class="st">&quot;Graph traversal can be exponentially expensive. Always limit depth and use restrictive matching.&quot;</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Use Case Examples<span class="op">:**</span> <span class="st">&quot;Perfect for organizational hierarchies, category trees, but dangerous for unlimited network traversal.&quot;</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a># üåê $graphLookup<span class="op">:</span> Recursive Relationship <span class="bu">Performance</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="unionwith-collection-merging-performance">üîÄ $unionWith:
        Collection Merging Performance</h1>
        <h2 id="efficient-multi-collection-aggregation">Efficient
        Multi-Collection Aggregation</h2>
        <h3 id="unionwith-optimization-strategies">$unionWith
        Optimization Strategies</h3>
        <div class="sourceCode" id="cb19"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Union with similar-sized, filtered collections</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$unionWith</span><span class="op">:</span> {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">coll</span><span class="op">:</span> <span class="st">&quot;archived_orders&quot;</span><span class="op">,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pipeline</span><span class="op">:</span> [</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$match</span><span class="op">:</span> { <span class="dt">date</span><span class="op">:</span> { <span class="dt">$gte</span><span class="op">:</span> <span class="fu">ISODate</span>(<span class="st">&quot;2024-01-01&quot;</span>) } } }<span class="op">,</span>  <span class="co">// Filter early!</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$project</span><span class="op">:</span> { <span class="dt">customerId</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">amount</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">date</span><span class="op">:</span> <span class="dv">1</span> } }     <span class="co">// Consistent schema</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">// PERFORMANCE CONSIDERATIONS:</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Both collections should have similar document structure</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Apply filters in the pipeline to reduce data volume</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Union similar-sized collections when possible</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Index the fields used in union pipeline filters</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Union large unfiltered collections</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$unionWith</span><span class="op">:</span> { <span class="dt">coll</span><span class="op">:</span> <span class="st">&quot;massive_historical_data&quot;</span> } }  <span class="co">// No filtering!</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a># üîÄ $unionWith<span class="op">:</span> Collection Merging <span class="bu">Performance</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="advanced-unionwith-patterns">Advanced $unionWith
        Patterns</h3>
        <div class="sourceCode" id="cb20"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Combine current and historical data efficiently</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$match</span><span class="op">:</span> { <span class="dt">status</span><span class="op">:</span> <span class="st">&quot;active&quot;</span> } }<span class="op">,</span>                    <span class="co">// Filter current collection</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$unionWith</span><span class="op">:</span> {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">coll</span><span class="op">:</span> <span class="st">&quot;historical_data&quot;</span><span class="op">,</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pipeline</span><span class="op">:</span> [</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$match</span><span class="op">:</span> { </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                <span class="dt">archived_date</span><span class="op">:</span> { <span class="dt">$gte</span><span class="op">:</span> <span class="fu">ISODate</span>(<span class="st">&quot;2023-01-01&quot;</span>) }<span class="op">,</span>  <span class="co">// Recent archives only</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                <span class="dt">status</span><span class="op">:</span> <span class="st">&quot;completed&quot;</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            }}<span class="op">,</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$addFields</span><span class="op">:</span> { <span class="dt">source</span><span class="op">:</span> <span class="st">&quot;historical&quot;</span> } }             <span class="co">// Tag source</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$group</span><span class="op">:</span> { </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$customerId&quot;</span><span class="op">,</span> </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalValue</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span> }<span class="op">,</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sources</span><span class="op">:</span> { <span class="dt">$addToSet</span><span class="op">:</span> <span class="st">&quot;$source&quot;</span> }</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Schema Consistency<span class="op">:**</span> <span class="st">&quot;Union works best with similar schemas. Wildly different document structures can cause issues.&quot;</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Collection Size<span class="op">:**</span> <span class="st">&quot;Union similar-sized collections when possible. 1M + 1K is fine, 1M + 10M might not be.&quot;</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a># üîÄ $unionWith<span class="op">:</span> Collection Merging <span class="bu">Performance</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="facet-multi-pipeline-performance">üé≠ $facet:
        Multi-Pipeline Performance</h1>
        <h2 id="parallel-pipeline-execution-optimization">Parallel
        Pipeline Execution Optimization</h2>
        <h3 id="understanding-facet-resource-usage">Understanding $facet
        Resource Usage</h3>
        <div class="sourceCode" id="cb21"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// $facet runs multiple pipelines in parallel on the SAME dataset</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory usage = sum of all sub-pipeline memory requirements</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">// CPU usage = parallel execution (good for multi-core systems)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$facet</span><span class="op">:</span> {</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sub-pipeline 1: Aggregation analysis</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;salesSummary&quot;</span><span class="op">:</span> [</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$group</span><span class="op">:</span> { </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$region&quot;</span><span class="op">,</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">totalSales</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span> }<span class="op">,</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">avgOrderValue</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span> }</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        }}<span class="op">,</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">totalSales</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sub-pipeline 2: Distribution analysis  </span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;priceDistribution&quot;</span><span class="op">:</span> [</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$bucket</span><span class="op">:</span> {</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">groupBy</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span><span class="op">,</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">boundaries</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="dv">5000</span>]<span class="op">,</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span> <span class="st">&quot;premium&quot;</span><span class="op">,</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">output</span><span class="op">:</span> { <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> } }</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        }}</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sub-pipeline 3: Time series analysis</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dailyTrends&quot;</span><span class="op">:</span> [</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>            <span class="dt">_id</span><span class="op">:</span> { <span class="dt">$dateToString</span><span class="op">:</span> { <span class="dt">format</span><span class="op">:</span> <span class="st">&quot;%Y-%m-%d&quot;</span><span class="op">,</span> <span class="dt">date</span><span class="op">:</span> <span class="st">&quot;$date&quot;</span> } }<span class="op">,</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>            <span class="dt">dailyRevenue</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span> }<span class="op">,</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">orderCount</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        }}<span class="op">,</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$sort</span><span class="op">:</span> { <span class="st">&quot;_id&quot;</span><span class="op">:</span> <span class="dv">1</span> } }<span class="op">,</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$limit</span><span class="op">:</span> <span class="dv">30</span> }  <span class="co">// Last 30 days</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Total memory = salesSummary memory + priceDistribution memory + dailyTrends memory</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a># üé≠ $facet<span class="op">:</span> Multi<span class="op">-</span>Pipeline <span class="bu">Performance</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Resource Usage:</strong> ‚ÄúMemory usage is additive
        across sub-pipelines. Three 100MB sub-pipelines = 300MB
        total.‚Äù</p>
        <p><strong>Parallel Processing:</strong> ‚ÄúGood for multi-core
        systems, but watch total memory consumption.‚Äù</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="bucket-bucketauto-data-distribution-analysis">üìä $bucket
        &amp; $bucketAuto: Data Distribution Analysis</h1>
        <h1 id="bucket-bucketauto-data-distribution-analysis-1">üìä
        $bucket &amp; $bucketAuto: Data Distribution Analysis</h1>
        <h2 id="efficient-data-segmentation">Efficient Data
        Segmentation</h2>
        <h3 id="bucket-performance-optimization">$bucket Performance
        Optimization</h3>
        <div class="sourceCode" id="cb22"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Reasonable number of buckets with indexed groupBy field</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$bucket</span><span class="op">:</span> {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">groupBy</span><span class="op">:</span> <span class="st">&quot;$price&quot;</span><span class="op">,</span>                    <span class="co">// Should be indexed!</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boundaries</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="dv">5000</span>]<span class="op">,</span>  <span class="co">// 6 buckets</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span> <span class="st">&quot;premium&quot;</span><span class="op">,</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgRating</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$rating&quot;</span> }<span class="op">,</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">products</span><span class="op">:</span> { <span class="dt">$push</span><span class="op">:</span> <span class="st">&quot;$name&quot;</span> }       <span class="co">// Be careful with array size!</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Index needed: { price: 1 }</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a># üìä $bucket <span class="op">&amp;</span> $bucketAuto<span class="op">:</span> Data Distribution <span class="fu">Analysis</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="bucketauto-for-dynamic-distribution">$bucketAuto for
        Dynamic Distribution</h3>
        <div class="sourceCode" id="cb23"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EXCELLENT: Let MongoDB determine optimal boundaries</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$bucketAuto</span><span class="op">:</span> {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">groupBy</span><span class="op">:</span> <span class="st">&quot;$revenue&quot;</span><span class="op">,</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">buckets</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span>                          <span class="co">// MongoDB optimizes boundaries</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">minRevenue</span><span class="op">:</span> { <span class="dt">$min</span><span class="op">:</span> <span class="st">&quot;$revenue&quot;</span> }<span class="op">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">maxRevenue</span><span class="op">:</span> { <span class="dt">$max</span><span class="op">:</span> <span class="st">&quot;$revenue&quot;</span> }<span class="op">,</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgCustomers</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$customerCount&quot;</span> }</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Advantages:</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Automatically distributes data evenly across buckets</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. No need to know data distribution beforehand</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Handles outliers gracefully</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Boundary Strategy<span class="op">:**</span> <span class="st">&quot;Good boundaries make for meaningful analysis. Bad boundaries create misleading results.&quot;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span><span class="bu">Index</span> Requirement<span class="op">:**</span> <span class="st">&quot;GroupBy fields should be indexed for good performance.&quot;</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a># üìä $bucket <span class="op">&amp;</span> $bucketAuto<span class="op">:</span> Data Distribution <span class="fu">Analysis</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="sample-random-sampling-performance">üé≤ $sample: Random
        Sampling Performance</h1>
        <h1 id="sample-random-sampling-performance-1">üé≤ $sample: Random
        Sampling Performance</h1>
        <h2 id="efficient-random-data-selection">Efficient Random Data
        Selection</h2>
        <h3 id="sample-implementation-details">$sample Implementation
        Details</h3>
        <div class="sourceCode" id="cb24"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Small sample from large collection</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$sample</span><span class="op">:</span> { <span class="dt">size</span><span class="op">:</span> <span class="dv">1000</span> } }</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">// MongoDB uses different algorithms based on:</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Sample size vs collection size ratio</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Whether collection has efficient random access</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">// FAST: Small samples (&lt; 5% of collection)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Uses random cursor positioning</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">// SLOWER: Large samples (&gt; 5% of collection)  </span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Uses temporary collection with random sort</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">// MEMORY EFFICIENT: $sample is always streaming</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Doesn&#39;t load entire collection into memory</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a># üé≤ $sample<span class="op">:</span> Random Sampling <span class="bu">Performance</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="sample-optimization-patterns">$sample Optimization
        Patterns</h3>
        <div class="sourceCode" id="cb25"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Sample before expensive operations</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$match</span><span class="op">:</span> { <span class="dt">active</span><span class="op">:</span> <span class="kw">true</span> } }<span class="op">,</span>         <span class="co">// Filter first</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$sample</span><span class="op">:</span> { <span class="dt">size</span><span class="op">:</span> <span class="dv">10000</span> } }<span class="op">,</span>         <span class="co">// Sample from filtered set</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$lookup</span><span class="op">:</span> { <span class="co">/* expensive join */</span> } }<span class="op">,</span> <span class="co">// Expensive operations on sample</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$facet</span><span class="op">:</span> { <span class="co">/* complex analysis */</span> } }</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Sample after expensive operations</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$lookup</span><span class="op">:</span> { <span class="co">/* expensive join */</span> } }<span class="op">,</span>  <span class="co">// Process all data first</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$facet</span><span class="op">:</span> { <span class="co">/* complex analysis */</span> } }<span class="op">,</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$sample</span><span class="op">:</span> { <span class="dt">size</span><span class="op">:</span> <span class="dv">10000</span> } }          <span class="co">// Sample at the end - wasteful!</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a># üé≤ $sample<span class="op">:</span> Random Sampling <span class="bu">Performance</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Algorithm Awareness:</strong> ‚ÄúMongoDB uses different
        sampling algorithms based on sample size. Small samples are very
        efficient.‚Äù</p>
        <p><strong>Pipeline Position:</strong> ‚ÄúSample early in
        pipelines to reduce computational load on expensive
        operations.‚Äù</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="search-searchmeta-atlas-search-performance">üîç $search
        &amp; $searchMeta: Atlas Search Performance</h1>
        <h1 id="search-searchmeta-atlas-search-performance-1">üîç $search
        &amp; $searchMeta: Atlas Search Performance</h1>
        <h2 id="atlas-search-integration-optimization">Atlas Search
        Integration Optimization</h2>
        <h3 id="search-performance-characteristics">$search Performance
        Characteristics</h3>
        <div class="sourceCode" id="cb26"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// $search is only available on MongoDB Atlas</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Powered by Apache Lucene for full-text search</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">// EXCELLENT: Properly configured search index</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$search</span><span class="op">:</span> {</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index</span><span class="op">:</span> <span class="st">&quot;product_search&quot;</span><span class="op">,</span>              <span class="co">// Dedicated search index</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compound</span><span class="op">:</span> {</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">must</span><span class="op">:</span> [</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">text</span><span class="op">:</span> { <span class="dt">query</span><span class="op">:</span> <span class="st">&quot;wireless headphones&quot;</span><span class="op">,</span> <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;title&quot;</span> } }</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">filter</span><span class="op">:</span> [</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">range</span><span class="op">:</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;price&quot;</span><span class="op">,</span> <span class="dt">gte</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">lte</span><span class="op">:</span> <span class="dv">300</span> } }<span class="op">,</span>      <span class="co">// Numeric filter</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">term</span><span class="op">:</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;category&quot;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">&quot;electronics&quot;</span> } }   <span class="co">// Exact match</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">highlight</span><span class="op">:</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;description&quot;</span> }</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance factors:</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Search index design and field mappings</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Query complexity (compound queries slower than simple text)</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Result set size (use limit!)</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Highlighting and scoring requirements</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a># üîç $search <span class="op">&amp;</span> $searchMeta<span class="op">:</span> Atlas Search <span class="bu">Performance</span> (<span class="bu">Performance</span>)</span></code></pre></div>
        <h3 id="searchmeta-for-performance-analysis">$searchMeta for
        Performance Analysis</h3>
        <div class="sourceCode" id="cb27"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Use $searchMeta to get search statistics without documents</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$searchMeta</span><span class="op">:</span> {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index</span><span class="op">:</span> <span class="st">&quot;product_search&quot;</span><span class="op">,</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compound</span><span class="op">:</span> {</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">must</span><span class="op">:</span> [{ <span class="dt">text</span><span class="op">:</span> { <span class="dt">query</span><span class="op">:</span> <span class="st">&quot;laptop&quot;</span><span class="op">,</span> <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;title&quot;</span> } }]<span class="op">,</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">filter</span><span class="op">:</span> [{ <span class="dt">range</span><span class="op">:</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;price&quot;</span><span class="op">,</span> <span class="dt">gte</span><span class="op">:</span> <span class="dv">500</span> } }]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns: { count: { lowerBound: NumberLong(42) } }</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Use this for pagination and performance planning</span></span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="geonear-geospatial-query-performance">üåç $geoNear:
        Geospatial Query Performance</h1>
        <h1 id="geonear-geospatial-query-performance-1">üåç $geoNear:
        Geospatial Query Performance</h1>
        <h2 id="efficient-location-based-aggregation">Efficient
        Location-Based Aggregation</h2>
        <h3 id="geonear-optimization-requirements">$geoNear Optimization
        Requirements</h3>
        <div class="sourceCode" id="cb28"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// CRITICAL: $geoNear MUST be the first stage in pipeline</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Requires 2dsphere or 2d index on the queried field</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Index required: { location: &quot;2dsphere&quot; }</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$geoNear</span><span class="op">:</span> {</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">near</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [<span class="op">-</span><span class="fl">73.9857</span><span class="op">,</span> <span class="fl">40.7484</span>] }<span class="op">,</span>  <span class="co">// NYC</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">distanceField</span><span class="op">:</span> <span class="st">&quot;distance&quot;</span><span class="op">,</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxDistance</span><span class="op">:</span> <span class="dv">5000</span><span class="op">,</span>                    <span class="co">// 5km radius</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">spherical</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>                      <span class="co">// Use spherical calculations</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">query</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;restaurant&quot;</span> }<span class="op">,</span>       <span class="co">// Additional filtering</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">limit</span><span class="op">:</span> <span class="dv">100</span>                           <span class="co">// Limit results for performance</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance optimization:</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Use smallest practical maxDistance</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Include query filters to reduce candidate set  </span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Limit results to reasonable number</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Consider multiple smaller queries vs one large query</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a># üåç $geoNear<span class="op">:</span> Geospatial Query <span class="bu">Performance</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="advanced-geospatial-patterns">Advanced Geospatial
        Patterns</h3>
        <div class="sourceCode" id="cb29"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Combine $geoNear with aggregation for location analytics</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$geoNear</span><span class="op">:</span> {</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">near</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [<span class="op">-</span><span class="fl">73.9857</span><span class="op">,</span> <span class="fl">40.7484</span>] }<span class="op">,</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">distanceField</span><span class="op">:</span> <span class="st">&quot;distance&quot;</span><span class="op">,</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">maxDistance</span><span class="op">:</span> <span class="dv">10000</span><span class="op">,</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">query</span><span class="op">:</span> { <span class="dt">active</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">spherical</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$addFields</span><span class="op">:</span> { </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">distanceKm</span><span class="op">:</span> { <span class="dt">$divide</span><span class="op">:</span> [<span class="st">&quot;$distance&quot;</span><span class="op">,</span> <span class="dv">1000</span>] }<span class="op">,</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zone</span><span class="op">:</span> {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$switch</span><span class="op">:</span> {</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                <span class="dt">branches</span><span class="op">:</span> [</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                    { <span class="dt">case</span><span class="op">:</span> { <span class="dt">$lte</span><span class="op">:</span> [<span class="st">&quot;$distance&quot;</span><span class="op">,</span> <span class="dv">1000</span>] }<span class="op">,</span> <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;immediate&quot;</span> }<span class="op">,</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                    { <span class="dt">case</span><span class="op">:</span> { <span class="dt">$lte</span><span class="op">:</span> [<span class="st">&quot;$distance&quot;</span><span class="op">,</span> <span class="dv">5000</span>] }<span class="op">,</span> <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;nearby&quot;</span> }</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                ]<span class="op">,</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">default</span><span class="op">:</span> <span class="st">&quot;distant&quot;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$zone&quot;</span><span class="op">,</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgDistance</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$distanceKm&quot;</span> }</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Atlas Only<span class="op">:**</span> <span class="st">&quot;Remember, this only works on Atlas. For self-hosted, stick with text indexes and regex optimization.&quot;</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="op">**</span><span class="bu">Index</span> Design<span class="op">:**</span> <span class="st">&quot;Search index design is crucial for performance. Plan your field mappings carefully.&quot;</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a># üåç $geoNear<span class="op">:</span> Geospatial Query <span class="bu">Performance</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="redact-document-level-security-filtering">üîí $redact:
        Document-Level Security &amp; Filtering</h1>
        <h1 id="redact-document-level-security-filtering-1">üîí $redact:
        Document-Level Security &amp; Filtering</h1>
        <h2 id="conditional-document-processing">Conditional Document
        Processing</h2>
        <h3 id="redact-performance-patterns">$redact Performance
        Patterns</h3>
        <div class="sourceCode" id="cb30"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">// $redact conditionally includes/excludes documents based on document content</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">// More flexible than $match but potentially slower</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$redact</span><span class="op">:</span> {</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">$cond</span><span class="op">:</span> {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">if</span><span class="op">:</span> {</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$gt</span><span class="op">:</span> [</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">$size</span><span class="op">:</span> { <span class="dt">$setIntersection</span><span class="op">:</span> [<span class="st">&quot;$userRoles&quot;</span><span class="op">,</span> [<span class="st">&quot;admin&quot;</span><span class="op">,</span> <span class="st">&quot;manager&quot;</span>]] } }<span class="op">,</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;$$DESCEND&quot;</span><span class="op">,</span>    <span class="co">// Include document, continue processing subdocs</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">else</span><span class="op">:</span> <span class="st">&quot;$$PRUNE&quot;</span>       <span class="co">// Exclude document entirely</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance considerations:</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. $redact processes each document individually (streaming)</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Complex conditions can be expensive</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Consider $match for simple filters before $redact</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Use for security/access control scenarios</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a># üîí $redact<span class="op">:</span> <span class="bu">Document</span><span class="op">-</span>Level Security <span class="op">&amp;</span> <span class="fu">Filtering</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="advanced-redact-security-patterns">Advanced $redact
        Security Patterns</h3>
        <div class="sourceCode" id="cb31"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Multi-level document redaction based on user permissions</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$redact</span><span class="op">:</span> {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">$cond</span><span class="op">:</span> {</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">if</span><span class="op">:</span> { <span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;$classification&quot;</span><span class="op">,</span> [<span class="st">&quot;public&quot;</span><span class="op">,</span> <span class="st">&quot;internal&quot;</span>]] }<span class="op">,</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">then</span><span class="op">:</span> {</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$cond</span><span class="op">:</span> {</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                <span class="dt">if</span><span class="op">:</span> { <span class="dt">$eq</span><span class="op">:</span> [<span class="st">&quot;$classification&quot;</span><span class="op">,</span> <span class="st">&quot;internal&quot;</span>] }<span class="op">,</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                <span class="dt">then</span><span class="op">:</span> {</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">$cond</span><span class="op">:</span> {</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">if</span><span class="op">:</span> { <span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;$$userRole&quot;</span><span class="op">,</span> [<span class="st">&quot;employee&quot;</span><span class="op">,</span> <span class="st">&quot;manager&quot;</span><span class="op">,</span> <span class="st">&quot;admin&quot;</span>]] }<span class="op">,</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">then</span><span class="op">:</span> <span class="st">&quot;$$DESCEND&quot;</span><span class="op">,</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">else</span><span class="op">:</span> <span class="st">&quot;$$PRUNE&quot;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                <span class="dt">else</span><span class="op">:</span> <span class="st">&quot;$$DESCEND&quot;</span>  <span class="co">// Public documents always visible</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">else</span><span class="op">:</span> <span class="st">&quot;$$PRUNE&quot;</span>  <span class="co">// Classified documents hidden</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>First Stage Rule<span class="op">:**</span> <span class="st">&quot;$geoNear MUST be first. No exceptions. Plan your pipeline accordingly.&quot;</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Distance Strategy<span class="op">:**</span> <span class="st">&quot;Use the smallest practical distance for your use case to limit candidate documents.&quot;</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a># üîí $redact<span class="op">:</span> <span class="bu">Document</span><span class="op">-</span>Level Security <span class="op">&amp;</span> <span class="fu">Filtering</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Analytics Combination:</strong> ‚ÄúGreat for
        location-based analytics combined with aggregation.‚Äù</p>
        <p><strong>Multiple Queries:</strong> ‚ÄúSometimes multiple
        smaller radius queries perform better than one large radius
        query.‚Äù</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="out-merge-output-operations-performance">üì§ $out &amp;
        $merge: Output Operations Performance</h1>
        <h1 id="out-merge-output-operations-performance-1">üì§ $out &amp;
        $merge: Output Operations Performance</h1>
        <h2 id="efficient-result-persistence">Efficient Result
        Persistence</h2>
        <h3 id="out-complete-collection-replacement">$out: Complete
        Collection Replacement</h3>
        <div class="sourceCode" id="cb32"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">// $out replaces entire target collection</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$out</span><span class="op">:</span> <span class="st">&quot;monthly_sales_summary&quot;</span> }</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance characteristics:</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Atomic operation - either succeeds completely or fails</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Drops existing collection and recreates</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. No concurrent writes allowed during operation</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Memory efficient - streams results to new collection</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">// 5. Cannot output to same collection being aggregated</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD for: Periodic full refreshes, ETL processes</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD for: Incremental updates, high-frequency operations</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a># üì§ $out <span class="op">&amp;</span> $merge<span class="op">:</span> Output Operations <span class="bu">Performance</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="merge-sophisticated-upsert-operations">$merge:
        Sophisticated Upsert Operations</h3>
        <div class="sourceCode" id="cb33"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// $merge provides flexible output with upsert capabilities</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$merge</span><span class="op">:</span> {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">into</span><span class="op">:</span> <span class="st">&quot;user_analytics&quot;</span><span class="op">,</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">on</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span>                           <span class="co">// Match field(s)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">whenMatched</span><span class="op">:</span> <span class="st">&quot;merge&quot;</span><span class="op">,</span>               <span class="co">// merge | replace | keepExisting | fail | pipeline</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">whenNotMatched</span><span class="op">:</span> <span class="st">&quot;insert&quot;</span>            <span class="co">// insert | discard | fail</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Advanced $merge with pipeline processing</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$merge</span><span class="op">:</span> {</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">into</span><span class="op">:</span> <span class="st">&quot;daily_summaries&quot;</span><span class="op">,</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">on</span><span class="op">:</span> [<span class="st">&quot;date&quot;</span><span class="op">,</span> <span class="st">&quot;region&quot;</span>]<span class="op">,</span>             <span class="co">// Compound match key</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">whenMatched</span><span class="op">:</span> [                      <span class="co">// Custom pipeline for matches</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$addFields</span><span class="op">:</span> { </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">lastUpdated</span><span class="op">:</span> <span class="st">&quot;$$NOW&quot;</span><span class="op">,</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">previousValue</span><span class="op">:</span> <span class="st">&quot;$totalSales&quot;</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        }}<span class="op">,</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">$set</span><span class="op">:</span> { <span class="dt">totalSales</span><span class="op">:</span> <span class="st">&quot;$$new.totalSales&quot;</span> } }</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">whenNotMatched</span><span class="op">:</span> <span class="st">&quot;insert&quot;</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a># üì§ $out <span class="op">&amp;</span> $merge<span class="op">:</span> Output Operations <span class="bu">Performance</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Security vs Performance:</strong> ‚Äú$redact provides
        document-level security but at a performance cost compared to
        $match.‚Äù</p>
        <p><strong>Use Case Fit:</strong> ‚ÄúPerfect for multi-tenant
        systems where different users see different document
        portions.‚Äù</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="setwindowfields-advanced-analytics-functions">ü™ü
        $setWindowFields: Advanced Analytics Functions</h1>
        <h1 id="setwindowfields-advanced-analytics-functions-1">ü™ü
        $setWindowFields: Advanced Analytics Functions</h1>
        <h2 id="window-function-performance-optimization">Window
        Function Performance Optimization</h2>
        <h3 id="understanding-window-function-cost">Understanding Window
        Function Cost</h3>
        <div class="sourceCode" id="cb34"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Window functions operate on partitioned and sorted datasets</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance depends on:</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Partition size (number of docs per partition)</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Sort requirements (indexed vs non-indexed)</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Window frame size</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Number of output fields computed</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$setWindowFields</span><span class="op">:</span> {</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">partitionBy</span><span class="op">:</span> <span class="st">&quot;$customerId&quot;</span><span class="op">,</span>         <span class="co">// Creates partitions - should be indexed!</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sortBy</span><span class="op">:</span> { <span class="dt">orderDate</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span>          <span class="co">// Sort within partition - needs index!</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Efficient: Single value calculations</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">customerRank</span><span class="op">:</span> { <span class="dt">$rank</span><span class="op">:</span> {} }<span class="op">,</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">orderNumber</span><span class="op">:</span> { <span class="dt">$documentNumber</span><span class="op">:</span> {} }<span class="op">,</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Moderate cost: Small window calculations</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">movingAverage</span><span class="op">:</span> { </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span><span class="op">,</span> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">window</span><span class="op">:</span> { <span class="dt">documents</span><span class="op">:</span> [<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span>] }  <span class="co">// 5-document window</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Higher cost: Large window or unbounded calculations</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">runningTotal</span><span class="op">:</span> { </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span><span class="op">,</span> </span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">window</span><span class="op">:</span> { <span class="dt">documents</span><span class="op">:</span> [<span class="st">&quot;unbounded&quot;</span><span class="op">,</span> <span class="st">&quot;current&quot;</span>] }</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Required indexes: { customerId: 1, orderDate: 1 }</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a># ü™ü $setWindowFields<span class="op">:</span> Advanced Analytics <span class="fu">Functions</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="densify-fill-time-series-data-completion">üìà $densify
        &amp; $fill: Time Series Data Completion</h1>
        <h1 id="densify-fill-time-series-data-completion-1">üìà $densify
        &amp; $fill: Time Series Data Completion</h1>
        <h2 id="mongodb-6.0-time-series-enhancements">MongoDB 6.0+ Time
        Series Enhancements</h2>
        <h3 id="densify-gap-filling-for-time-series">$densify: Gap
        Filling for Time Series</h3>
        <div class="sourceCode" id="cb35"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create missing time points in time series data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$densify</span><span class="op">:</span> {</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">field</span><span class="op">:</span> <span class="st">&quot;timestamp&quot;</span><span class="op">,</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">partitionByFields</span><span class="op">:</span> [<span class="st">&quot;sensorId&quot;</span>]<span class="op">,</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> {</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unit</span><span class="op">:</span> <span class="st">&quot;hour&quot;</span><span class="op">,</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bounds</span><span class="op">:</span> [</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ISODate</span>(<span class="st">&quot;2024-01-01T00:00:00Z&quot;</span>)<span class="op">,</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ISODate</span>(<span class="st">&quot;2024-01-31T23:59:59Z&quot;</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance considerations:</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Can dramatically increase document count</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Use narrow time ranges when possible</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Consider impact on subsequent pipeline stages</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Useful for regular reporting intervals</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a># üìà $densify <span class="op">&amp;</span> $fill<span class="op">:</span> Time Series Data <span class="fu">Completion</span> (Part <span class="dv">1</span>)</span></code></pre></div>
        <h3 id="fill-value-interpolation">$fill: Value
        Interpolation</h3>
        <div class="sourceCode" id="cb36"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Fill missing values using various methods</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$fill</span><span class="op">:</span> {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">partitionBy</span><span class="op">:</span> <span class="st">&quot;$sensorId&quot;</span><span class="op">,</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sortBy</span><span class="op">:</span> { <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">temperature</span><span class="op">:</span> { <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;linear&quot;</span> }<span class="op">,</span>      <span class="co">// Linear interpolation</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">humidity</span><span class="op">:</span> { <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;locf&quot;</span> }<span class="op">,</span>           <span class="co">// Last observation carried forward</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">status</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">&quot;unknown&quot;</span> }           <span class="co">// Fixed value</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Combine $densify and $fill for complete time series</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$densify</span><span class="op">:</span> { <span class="co">/* create missing time points */</span> } }<span class="op">,</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$fill</span><span class="op">:</span> { <span class="co">/* interpolate missing values */</span> } }</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a># üìà $densify <span class="op">&amp;</span> $fill<span class="op">:</span> Time Series Data <span class="fu">Completion</span> (Part <span class="dv">3</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="advanced-pipeline-optimization-strategies">üéØ Advanced
        Pipeline Optimization Strategies</h1>
        <h1 id="advanced-pipeline-optimization-strategies-1">üéØ Advanced
        Pipeline Optimization Strategies</h1>
        <h2 id="operator-ordering-for-maximum-performance">Operator
        Ordering for Maximum Performance</h2>
        <h3 id="the-complete-esr-principle-for-aggregations">The
        Complete ESR Principle for Aggregations</h3>
        <div class="sourceCode" id="cb37"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Extended ESR: Equality ‚Üí Sort ‚Üí Range ‚Üí Transform ‚Üí Join ‚Üí Aggregate ‚Üí Output</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. EQUALITY FILTERS (Use indexes, highest selectivity)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$match</span><span class="op">:</span> { <span class="dt">status</span><span class="op">:</span> <span class="st">&quot;active&quot;</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;premium&quot;</span> } }<span class="op">,</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. SORT (Use indexes when possible)</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">priority</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">date</span><span class="op">:</span> <span class="dv">1</span> } }<span class="op">,</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. RANGE FILTERS (Use indexes, limit dataset)</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$match</span><span class="op">:</span> { <span class="dt">amount</span><span class="op">:</span> { <span class="dt">$gte</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">$lte</span><span class="op">:</span> <span class="dv">10000</span> } } }<span class="op">,</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. LIMIT (Reduce dataset before expensive operations)</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$limit</span><span class="op">:</span> <span class="dv">10000</span> }<span class="op">,</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 5. TRANSFORM (Add computed fields, reshape documents)</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$addFields</span><span class="op">:</span> { <span class="dt">quarter</span><span class="op">:</span> { <span class="dt">$quarter</span><span class="op">:</span> <span class="st">&quot;$date&quot;</span> } } }<span class="op">,</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$project</span><span class="op">:</span> { <span class="dt">essentialFields</span><span class="op">:</span> <span class="dv">1</span> } }<span class="op">,</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 6. JOIN (Lookup external data)</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$lookup</span><span class="op">:</span> { <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;reference_data&quot;</span><span class="op">,</span> <span class="op">...</span> } }<span class="op">,</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 7. AGGREGATE (Group, bucket, window functions)</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$group</span><span class="op">:</span> { <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$quarter&quot;</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span> } } }<span class="op">,</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 8. OUTPUT (Final sorting, limiting, output)</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">total</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }<span class="op">,</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$limit</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">,</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$merge</span><span class="op">:</span> { <span class="dt">into</span><span class="op">:</span> <span class="st">&quot;quarterly_results&quot;</span> } }</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a># üéØ Advanced Pipeline Optimization <span class="fu">Strategies</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="memory-management-across-all-operators">üß† Memory
        Management Across All Operators</h1>
        <h1 id="memory-management-across-all-operators-1">üß† Memory
        Management Across All Operators</h1>
        <h2 id="operator-specific-memory-patterns">Operator-Specific
        Memory Patterns</h2>
        <h3 id="high-memory-operators-use-with-caution">High Memory
        Operators (Use with Caution)</h3>
        <div class="sourceCode" id="cb38"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. $group with large cardinality</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$group</span><span class="op">:</span> { </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> { <span class="dt">user</span><span class="op">:</span> <span class="st">&quot;$userId&quot;</span><span class="op">,</span> <span class="dt">item</span><span class="op">:</span> <span class="st">&quot;$itemId&quot;</span><span class="op">,</span> <span class="dt">day</span><span class="op">:</span> <span class="st">&quot;$day&quot;</span> }<span class="op">,</span> <span class="co">// Millions of groups</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">docs</span><span class="op">:</span> { <span class="dt">$push</span><span class="op">:</span> <span class="st">&quot;$$ROOT&quot;</span> }  <span class="co">// Accumulates full documents</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory: Potentially GB+ for large datasets</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. $facet with multiple memory-intensive sub-pipelines</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$facet</span><span class="op">:</span> {</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">heavyAnalysis1</span><span class="op">:</span> [{ <span class="dt">$group</span><span class="op">:</span> { <span class="co">/* many groups */</span> } }]<span class="op">,</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">heavyAnalysis2</span><span class="op">:</span> [{ <span class="dt">$sort</span><span class="op">:</span> { <span class="co">/* large unsorted */</span> } }]<span class="op">,</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">heavyAnalysis3</span><span class="op">:</span> [{ <span class="dt">$bucket</span><span class="op">:</span> { <span class="co">/* complex bucketing */</span> } }]</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>}}</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory: Sum of all sub-pipeline memory requirements</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. $sort without index support</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">calculatedField</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }  <span class="co">// No index available</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory: Up to 100MB limit, then spills to disk</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a># üß† Memory Management Across All <span class="fu">Operators</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <h3
        id="memory-efficient-operators-safe-for-large-data">Memory-Efficient
        Operators (Safe for Large Data)</h3>
        <div class="sourceCode" id="cb39"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Streaming operators - process one document at a time:</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$match</span><span class="op">:</span> { <span class="op">...</span> } }           <span class="co">// No memory accumulation</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$project</span><span class="op">:</span> { <span class="op">...</span> } }         <span class="co">// Per-document transformation</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$addFields</span><span class="op">:</span> { <span class="op">...</span> } }       <span class="co">// Per-document field addition</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$replaceRoot</span><span class="op">:</span> { <span class="op">...</span> } }     <span class="co">// Per-document restructuring</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$redact</span><span class="op">:</span> { <span class="op">...</span> } }          <span class="co">// Per-document filtering</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$limit</span><span class="op">:</span> N }                 <span class="co">// Stops early, very efficient</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">$skip</span><span class="op">:</span> N }                  <span class="co">// Per-document decision</span></span></code></pre></div>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="performance-monitoring-for-all-operators">üìä Performance
        Monitoring for All Operators</h1>
        <h1 id="performance-monitoring-for-all-operators-1">üìä
        Performance Monitoring for All Operators</h1>
        <h2 id="comprehensive-pipeline-analysis">Comprehensive Pipeline
        Analysis</h2>
        <h3 id="using-explain-for-complete-pipeline-analysis">Using
        explain() for Complete Pipeline Analysis</h3>
        <div class="sourceCode" id="cb40"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Get detailed execution statistics for every stage</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pipeline <span class="op">=</span> [</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$match</span><span class="op">:</span> { <span class="dt">category</span><span class="op">:</span> <span class="st">&quot;electronics&quot;</span> } }<span class="op">,</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$lookup</span><span class="op">:</span> { <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;reviews&quot;</span><span class="op">,</span> <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span> <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;productId&quot;</span><span class="op">,</span> <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;reviews&quot;</span> } }<span class="op">,</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$addFields</span><span class="op">:</span> { <span class="dt">avgRating</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$reviews.rating&quot;</span> } } }<span class="op">,</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$group</span><span class="op">:</span> { <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$brand&quot;</span><span class="op">,</span> <span class="dt">avgBrandRating</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$avgRating&quot;</span> } } }<span class="op">,</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">avgBrandRating</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> explanation <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="at">products</span><span class="op">.</span><span class="fu">aggregate</span>(pipeline)<span class="op">.</span><span class="fu">explain</span>(<span class="st">&quot;executionStats&quot;</span>)<span class="op">;</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Analyze each stage:</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>explanation<span class="op">.</span><span class="at">stages</span><span class="op">.</span><span class="fu">forEach</span>((stage<span class="op">,</span> index) <span class="kw">=&gt;</span> {</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Stage </span><span class="sc">${</span>index<span class="sc">}</span><span class="vs">: </span><span class="sc">${</span><span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(stage)[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`  Execution Time: </span><span class="sc">${</span>stage<span class="op">.</span><span class="at">executionStats</span><span class="op">?.</span><span class="at">executionTimeMillis</span> <span class="op">||</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="vs">ms`</span>)<span class="op">;</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`  Documents In: </span><span class="sc">${</span>stage<span class="op">.</span><span class="at">executionStats</span><span class="op">?.</span><span class="at">totalDocsExamined</span> <span class="op">||</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`  Documents Out: </span><span class="sc">${</span>stage<span class="op">.</span><span class="at">executionStats</span><span class="op">?.</span><span class="at">totalDocsReturned</span> <span class="op">||</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`  Index Used: </span><span class="sc">${</span>stage<span class="op">.</span><span class="at">executionStats</span><span class="op">?.</span><span class="at">indexName</span> <span class="op">||</span> <span class="st">&#39;None&#39;</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`  Memory Usage: </span><span class="sc">${</span>stage<span class="op">.</span><span class="at">executionStats</span><span class="op">?.</span><span class="at">memUsage</span> <span class="op">||</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a># üìä <span class="bu">Performance</span> Monitoring <span class="cf">for</span> All <span class="fu">Operators</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="production-ready-optimization-checklist">üèÜ
        Production-Ready Optimization Checklist</h1>
        <h2 id="complete-operator-optimization-audit">Complete Operator
        Optimization Audit</h2>
        <h3 id="filtering-selection-operators">‚úÖ Filtering &amp;
        Selection Operators</h3>
        <ul class="task-list">
        <li><label><input type="checkbox" /><strong>$match</strong> uses
        indexed fields and appears early in pipeline</label></li>
        <li><label><input type="checkbox" /><strong>$redact</strong>
        logic is optimized and used only when necessary</label></li>
        <li><label><input type="checkbox" /><strong>$sample</strong>
        size is appropriate for dataset and appears before expensive
        operations</label></li>
        <li><label><input type="checkbox" /><strong><span
        class="math inline"><em>l</em><em>i</em><em>m</em><em>i</em><em>t</em>‚ÄÖ*‚ÄÖ*/‚ÄÖ*‚ÄÖ*</span>skip</strong>
        are used to bound result sets</label></li>
        </ul>
        <h3 id="transformation-operators">‚úÖ Transformation
        Operators</h3>
        <ul class="task-list">
        <li><label><input type="checkbox" /><strong>$project</strong>
        removes unnecessary fields before expensive
        operations</label></li>
        <li><label><input type="checkbox" /><strong><span
        class="math inline"><em>a</em><em>d</em><em>d</em><em>F</em><em>i</em><em>e</em><em>l</em><em>d</em><em>s</em>‚ÄÖ*‚ÄÖ*/‚ÄÖ*‚ÄÖ*</span>set</strong>
        computations are placed optimally in pipeline</label></li>
        <li><label><input type="checkbox" /><strong><span
        class="math inline"><em>r</em><em>e</em><em>p</em><em>l</em><em>a</em><em>c</em><em>e</em><em>R</em><em>o</em><em>o</em><em>t</em>‚ÄÖ*‚ÄÖ*/‚ÄÖ*‚ÄÖ*</span>replaceWith</strong>
        operations are memory-efficient</label></li>
        <li><label><input type="checkbox" /><strong>$unset</strong>
        removes large fields when no longer needed</label></li>
        </ul>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="production-ready-optimization-checklist-part-2">üèÜ
        Production-Ready Optimization Checklist (Part 2)</h1>
        <h3 id="joining-operators">‚úÖ Joining Operators</h3>
        <ul class="task-list">
        <li><label><input type="checkbox" /><strong>$lookup</strong>
        foreign fields are properly indexed</label></li>
        <li><label><input type="checkbox" /><strong>$lookup</strong>
        uses pipeline syntax for complex joins with
        filtering</label></li>
        <li><label><input
        type="checkbox" /><strong>$graphLookup</strong> has maxDepth
        limits and indexed connectToField</label></li>
        <li><label><input type="checkbox" /><strong>$unionWith</strong>
        collections have consistent schemas and filtering</label></li>
        </ul>
        <h3 id="aggregation-operators">‚úÖ Aggregation Operators</h3>
        <ul class="task-list">
        <li><label><input type="checkbox" /><strong>$group</strong>
        cardinality is reasonable for available memory</label></li>
        <li><label><input type="checkbox" /><strong><span
        class="math inline"><em>b</em><em>u</em><em>c</em><em>k</em><em>e</em><em>t</em>‚ÄÖ*‚ÄÖ*/‚ÄÖ*‚ÄÖ*</span>bucketAuto</strong>
        groupBy fields are indexed</label></li>
        <li><label><input type="checkbox" /><strong>$facet</strong>
        sub-pipelines are individually optimized</label></li>
        <li><label><input
        type="checkbox" /><strong>$setWindowFields</strong> partitionBy
        and sortBy fields are indexed</label></li>
        </ul>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="version-specific-feature-adoption">üéØ Version-Specific
        Feature Adoption</h1>
        <h2 id="leveraging-modern-mongodb-features">Leveraging Modern
        MongoDB Features</h2>
        <h3 id="mongodb-6.0-adoption-checklist">MongoDB 6.0+ Adoption
        Checklist</h3>
        <ul class="task-list">
        <li><label><input type="checkbox" />Replace <strong>$sort +
        <span
        class="math inline"><em>l</em><em>i</em><em>m</em><em>i</em><em>t</em>‚ÄÖ*‚ÄÖ*<em>p</em><em>a</em><em>t</em><em>t</em><em>e</em><em>r</em><em>n</em><em>s</em><em>w</em><em>i</em><em>t</em><em>h</em>‚ÄÖ*‚ÄÖ*</span>topN</strong>/<strong>$bottomN</strong></label></li>
        <li><label><input type="checkbox" />Use <strong>$lookup</strong>
        with sharded collections where beneficial</label></li>
        <li><label><input type="checkbox" />Implement <strong><span
        class="math inline"><em>d</em><em>e</em><em>n</em><em>s</em><em>i</em><em>f</em><em>y</em>‚ÄÖ*‚ÄÖ*/‚ÄÖ*‚ÄÖ*</span>fill</strong>
        for time series data completion</label></li>
        <li><label><input type="checkbox" />Leverage enhanced
        <strong>$setWindowFields</strong> capabilities</label></li>
        </ul>
        <h3 id="mongodb-7.0-optimization-benefits">MongoDB 7.0+
        Optimization Benefits</h3>
        <ul class="task-list">
        <li><label><input type="checkbox" />Verify <strong>slot-based
        execution engine</strong> usage for $group
        operations</label></li>
        <li><label><input type="checkbox" />Monitor query shape analysis
        improvements for plan caching</label></li>
        <li><label><input type="checkbox" />Use enhanced
        <strong>$search</strong> capabilities for Atlas
        deployments</label></li>
        </ul>
        <h3 id="mongodb-8.0-performance-features">MongoDB 8.0+
        Performance Features</h3>
        <ul class="task-list">
        <li><label><input type="checkbox" />Enable <strong>block
        processing</strong> for time series collections</label></li>
        <li><label><input type="checkbox" />Leverage <strong>improved
        bulk operations</strong> for data loading</label></li>
        <li><label><input type="checkbox" />Use <strong>enhanced memory
        management</strong> for large aggregation workloads</label></li>
        <li><label><input type="checkbox" />Monitor <strong>upgraded
        TCMalloc</strong> performance improvements</label></li>
        </ul>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="real-world-complete-pipeline-examples">üöÄ Real-World
        Complete Pipeline Examples</h1>
        <h1 id="real-world-complete-pipeline-examples-1">üöÄ Real-World
        Complete Pipeline Examples</h1>
        <h2 id="e-commerce-analytics-full-operator-showcase">E-Commerce
        Analytics: Full Operator Showcase</h2>
        <div class="sourceCode" id="cb41"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Complete e-commerce analytics pipeline using multiple operators</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">orders</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 1: Filter recent active orders</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$match</span><span class="op">:</span> { </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">createdAt</span><span class="op">:</span> { <span class="dt">$gte</span><span class="op">:</span> <span class="fu">ISODate</span>(<span class="st">&quot;2024-01-01&quot;</span>) }<span class="op">,</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">status</span><span class="op">:</span> { <span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;completed&quot;</span><span class="op">,</span> <span class="st">&quot;shipped&quot;</span>] }</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 2: Add computed fields for analysis</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$addFields</span><span class="op">:</span> {</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">orderValue</span><span class="op">:</span> { <span class="dt">$multiply</span><span class="op">:</span> [<span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="st">&quot;$quantity&quot;</span>] }<span class="op">,</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">quarter</span><span class="op">:</span> { <span class="dt">$quarter</span><span class="op">:</span> <span class="st">&quot;$createdAt&quot;</span> }<span class="op">,</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dayOfWeek</span><span class="op">:</span> { <span class="dt">$dayOfWeek</span><span class="op">:</span> <span class="st">&quot;$createdAt&quot;</span> }</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 3: Sample for development/testing</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$sample</span><span class="op">:</span> { <span class="dt">size</span><span class="op">:</span> <span class="dv">50000</span> } }<span class="op">,</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 4: Join with customer data</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$lookup</span><span class="op">:</span> {</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;customers&quot;</span><span class="op">,</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;customerId&quot;</span><span class="op">,</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pipeline</span><span class="op">:</span> [{ <span class="dt">$project</span><span class="op">:</span> { <span class="dt">region</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">segment</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">_id</span><span class="op">:</span> <span class="dv">0</span> } }]<span class="op">,</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;customer&quot;</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$customer&quot;</span> }<span class="op">,</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 5: Join with product catalog</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$lookup</span><span class="op">:</span> {</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;products&quot;</span><span class="op">,</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>        <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;productId&quot;</span><span class="op">,</span> </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pipeline</span><span class="op">:</span> [{ <span class="dt">$project</span><span class="op">:</span> { <span class="dt">category</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">brand</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">_id</span><span class="op">:</span> <span class="dv">0</span> } }]<span class="op">,</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;product&quot;</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$product&quot;</span> }<span class="op">,</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 6: Multi-dimensional analysis with $facet</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$facet</span><span class="op">:</span> {</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Regional analysis</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;regionalMetrics&quot;</span><span class="op">:</span> [</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$customer.region&quot;</span><span class="op">,</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>                <span class="dt">totalRevenue</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$orderValue&quot;</span> }<span class="op">,</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>                <span class="dt">orderCount</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>                <span class="dt">avgOrderValue</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$orderValue&quot;</span> }</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>            }}<span class="op">,</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">totalRevenue</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Category performance</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;categoryAnalysis&quot;</span><span class="op">:</span> [</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$bucket</span><span class="op">:</span> {</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>                <span class="dt">groupBy</span><span class="op">:</span> <span class="st">&quot;$orderValue&quot;</span><span class="op">,</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>                <span class="dt">boundaries</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="dv">5000</span>]<span class="op">,</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">default</span><span class="op">:</span> <span class="st">&quot;premium&quot;</span><span class="op">,</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>                <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">categories</span><span class="op">:</span> { <span class="dt">$addToSet</span><span class="op">:</span> <span class="st">&quot;$product.category&quot;</span> }</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>            }}</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Time-based trends</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;timeSeriesData&quot;</span><span class="op">:</span> [</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>                <span class="dt">_id</span><span class="op">:</span> {</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">quarter</span><span class="op">:</span> <span class="st">&quot;$quarter&quot;</span><span class="op">,</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">dayOfWeek</span><span class="op">:</span> <span class="st">&quot;$dayOfWeek&quot;</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>                <span class="dt">avgDailyRevenue</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$orderValue&quot;</span> }<span class="op">,</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>                <span class="dt">orderVolume</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>            }}<span class="op">,</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$sort</span><span class="op">:</span> { <span class="st">&quot;_id.quarter&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;_id.dayOfWeek&quot;</span><span class="op">:</span> <span class="dv">1</span> } }</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Top performers using MongoDB 6.0+ features</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;topPerformers&quot;</span><span class="op">:</span> [</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>                <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$product.brand&quot;</span><span class="op">,</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>                <span class="dt">brandMetrics</span><span class="op">:</span> {</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">$topN</span><span class="op">:</span> {</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">product</span><span class="op">:</span> <span class="st">&quot;$product.category&quot;</span><span class="op">,</span></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">revenue</span><span class="op">:</span> <span class="st">&quot;$orderValue&quot;</span><span class="op">,</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">customer</span><span class="op">:</span> <span class="st">&quot;$customer.segment&quot;</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a>                        }<span class="op">,</span></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">sortBy</span><span class="op">:</span> { <span class="dt">orderValue</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">n</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>            }}</span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 7: Reshape final output</span></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$project</span><span class="op">:</span> {</span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a>        <span class="dt">summary</span><span class="op">:</span> {</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>            <span class="dt">regions</span><span class="op">:</span> <span class="st">&quot;$regionalMetrics&quot;</span><span class="op">,</span></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a>            <span class="dt">categories</span><span class="op">:</span> <span class="st">&quot;$categoryAnalysis&quot;</span><span class="op">,</span> </span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a>            <span class="dt">trends</span><span class="op">:</span> <span class="st">&quot;$timeSeriesData&quot;</span><span class="op">,</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a>            <span class="dt">topBrands</span><span class="op">:</span> <span class="st">&quot;$topPerformers&quot;</span></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a>        <span class="dt">generatedAt</span><span class="op">:</span> <span class="st">&quot;$$NOW&quot;</span></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stage 8: Output to results collection</span></span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">$merge</span><span class="op">:</span> {</span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a>        <span class="dt">into</span><span class="op">:</span> <span class="st">&quot;analytics_dashboard&quot;</span><span class="op">,</span></span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a>        <span class="dt">on</span><span class="op">:</span> <span class="st">&quot;generatedAt&quot;</span><span class="op">,</span></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a>        <span class="dt">whenMatched</span><span class="op">:</span> <span class="st">&quot;replace&quot;</span><span class="op">,</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a>        <span class="dt">whenNotMatched</span><span class="op">:</span> <span class="st">&quot;insert&quot;</span></span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span> {</span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">allowDiskUse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>  <span class="co">// Handle large intermediate results</span></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxTimeMS</span><span class="op">:</span> <span class="dv">300000</span>    <span class="co">// 5-minute timeout for complex analysis</span></span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a># üöÄ Real<span class="op">-</span>World Complete Pipeline <span class="fu">Examples</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="complete-operator-mastery-key-takeaways">üéâ Complete
        Operator Mastery: Key Takeaways</h1>
        <h1 id="complete-operator-mastery-key-takeaways-1">üéâ Complete
        Operator Mastery: Key Takeaways</h1>
        <h2 id="essential-principles-for-every-operator">Essential
        Principles for Every Operator</h2>
        <h3 id="index-strategy-is-universal">1. <strong>Index Strategy
        is Universal</strong></h3>
        <p>Every operator benefits from proper indexing: -
        <strong>$match, $sort, <span
        class="math inline"><em>g</em><em>r</em><em>o</em><em>u</em><em>p</em>‚ÄÑ:‚ÄÑ*‚ÄÖ*‚ÄÖ<em>D</em><em>i</em><em>r</em><em>e</em><em>c</em><em>t</em><em>i</em><em>n</em><em>d</em><em>e</em><em>x</em><em>u</em><em>s</em><em>a</em><em>g</em><em>e</em>‚ÄÖ‚àí‚ÄÖ**</span>lookup,
        <span
        class="math inline"><em>g</em><em>r</em><em>a</em><em>p</em><em>h</em><em>L</em><em>o</em><em>o</em><em>k</em><em>u</em><em>p</em>‚ÄÑ:‚ÄÑ*‚ÄÖ*‚ÄÖ<em>F</em><em>o</em><em>r</em><em>e</em><em>i</em><em>g</em><em>n</em><em>f</em><em>i</em><em>e</em><em>l</em><em>d</em><em>i</em><em>n</em><em>d</em><em>e</em><em>x</em><em>i</em><em>n</em><em>g</em>‚ÄÖ‚àí‚ÄÖ**</span>geoNear,
        <span
        class="math inline"><em>s</em><em>e</em><em>a</em><em>r</em><em>c</em><em>h</em>‚ÄÑ:‚ÄÑ*‚ÄÖ*‚ÄÖ<em>S</em><em>p</em><em>e</em><em>c</em><em>i</em><em>a</em><em>l</em><em>i</em><em>z</em><em>e</em><em>d</em><em>i</em><em>n</em><em>d</em><em>e</em><em>x</em><em>r</em><em>e</em><em>q</em><em>u</em><em>i</em><em>r</em><em>e</em><em>m</em><em>e</em><em>n</em><em>t</em><em>s</em>‚ÄÖ‚àí‚ÄÖ**</span>bucket,
        $setWindowFields:</strong> GroupBy/partitionBy indexing</p>
        <h3 id="memory-management-scales-by-operator-type">2.
        <strong>Memory Management Scales by Operator Type</strong></h3>
        <ul>
        <li><strong>Streaming:</strong> $match, $project, $addFields,
        $replaceRoot, $limit</li>
        <li><strong>Accumulating:</strong> $group, $bucket, $facet,
        $sort</li>
        <li><strong>Joining:</strong> $lookup, $graphLookup,
        $unionWith</li>
        </ul>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="complete-operator-mastery-key-takeaways-part-2">üéâ
        Complete Operator Mastery: Key Takeaways (Part 2)</h1>
        <h3 id="pipeline-position-matters-for-every-operator">3.
        <strong>Pipeline Position Matters for Every
        Operator</strong></h3>
        <ul>
        <li><strong>Early:</strong> $match, $sample, $limit (reduce
        dataset)</li>
        <li><strong>Middle:</strong> $addFields, $project, $lookup
        (transform and join)</li>
        <li><strong>Late:</strong> $group, $facet, $sort, <span
        class="math inline"><em>o</em><em>u</em><em>t</em>/</span>merge
        (aggregate and output)</li>
        </ul>
        <h3 id="version-features-provide-real-performance-gains">4.
        <strong>Version Features Provide Real Performance
        Gains</strong></h3>
        <ul>
        <li><strong>MongoDB 6.0:</strong> topN/bottomN, sharded lookups,
        time series operators</li>
        <li><strong>MongoDB 7.0:</strong> Enhanced slot-based execution,
        better query planning</li>
        <li><strong>MongoDB 8.0:</strong> Block processing, improved
        memory management</li>
        </ul>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="next-steps-complete-pipeline-mastery">üöÄ Next Steps:
        Complete Pipeline Mastery</h1>
        <h2 id="immediate-actions-this-week">Immediate Actions (This
        Week)</h2>
        <ol type="1">
        <li><strong>Audit all aggregation pipelines</strong> for
        operator optimization opportunities</li>
        <li><strong>Profile your most complex pipelines</strong> using
        explain() for each stage</li>
        <li><strong>Identify unused operators</strong> that could
        simplify existing logic</li>
        <li><strong>Review index strategy</strong> for all operators in
        your pipelines</li>
        </ol>
        <h2 id="advanced-implementation-this-month">Advanced
        Implementation (This Month)</h2>
        <ol type="1">
        <li><strong>Refactor complex pipelines</strong> using modern
        operators (topN, bottomN, setWindowFields)</li>
        <li><strong>Implement incremental aggregation</strong> patterns
        for large dataset processing</li>
        <li><strong>Optimize memory usage</strong> across all operators
        in production pipelines</li>
        <li><strong>Set up monitoring</strong> for operator-specific
        performance metrics</li>
        </ol>
        <h2 id="strategic-planning-this-quarter">Strategic Planning
        (This Quarter)</h2>
        <ol type="1">
        <li><strong>Plan MongoDB version upgrades</strong> to leverage
        operator performance improvements</li>
        <li><strong>Design aggregation architecture</strong> with
        operator performance in mind</li>
        <li><strong>Create operator performance testing</strong>
        frameworks for your applications</li>
        <li><strong>Train team on complete operator
        optimization</strong> strategies</li>
        </ol>
        <p>You now have comprehensive mastery of every MongoDB
        aggregation operator! üéØ</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="advanced-pipeline-memory-management">üß† Advanced
        Pipeline Memory Management</h1>
        <h1 id="advanced-pipeline-memory-management-1">üß† Advanced
        Pipeline Memory Management</h1>
        <h2 id="resource-optimization-strategies">Resource Optimization
        Strategies</h2>
        <p><strong>Memory Accumulation Patterns</strong> - Documents
        grow through pipeline stages - $unwind operations multiply
        document count - $lookup operations add joined data - $group
        operations accumulate by cardinality</p>
        <p><strong>Memory Pressure Points</strong></p>
        <div class="sourceCode" id="cb42"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">// High memory usage pattern</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">orders</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$items&quot;</span>}<span class="op">,</span>        <span class="co">// Document explosion</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$lookup</span><span class="op">:</span> {                 <span class="co">// Adds product data</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;products&quot;</span><span class="op">,</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">localField</span><span class="op">:</span> <span class="st">&quot;items.productId&quot;</span><span class="op">,</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">foreignField</span><span class="op">:</span> <span class="st">&quot;_id&quot;</span><span class="op">,</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;productInfo&quot;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  }}<span class="op">,</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$group</span><span class="op">:</span> {                  <span class="co">// High cardinality grouping</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$userId&quot;</span><span class="op">,</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">totalSpent</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$items.price&quot;</span>}</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  }}</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Continuation<span class="op">:**</span> This slide continues the content <span class="im">from</span> the previous slide<span class="op">.</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key Focus<span class="op">:**</span> Maintain the same energy and emphasis <span class="im">from</span> the previous section<span class="op">.</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a># üß† Advanced Pipeline Memory <span class="fu">Management</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <p><strong>Optimization Techniques</strong> - Early filtering
        with $match - Strategic field removal with $unset - Controlled
        array processing - Pipeline segmentation for large
        operations</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="error-handling-and-robustness">üîß Error Handling and
        Robustness</h1>
        <h1 id="error-handling-and-robustness-1">üîß Error Handling and
        Robustness</h1>
        <h2 id="building-resilient-production-pipelines">Building
        Resilient Production Pipelines</h2>
        <p><strong>Data Quality Challenges</strong></p>
        <div class="sourceCode" id="cb43"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Robust error handling</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$match</span><span class="op">:</span> {</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createdDate</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">$type</span><span class="op">:</span> <span class="st">&quot;date&quot;</span>}<span class="op">,</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">status</span><span class="op">:</span> {<span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;active&quot;</span><span class="op">,</span> <span class="st">&quot;pending&quot;</span><span class="op">,</span> <span class="st">&quot;completed&quot;</span>]}</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  }}<span class="op">,</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$addFields</span><span class="op">:</span> {</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">safeAmount</span><span class="op">:</span> {</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">$ifNull</span><span class="op">:</span> [</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">$toDouble</span><span class="op">:</span> <span class="st">&quot;$amount&quot;</span>}<span class="op">,</span> </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">processedDate</span><span class="op">:</span> {</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">$ifNull</span><span class="op">:</span> [<span class="st">&quot;$processedDate&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()]</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  }}</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a># üîß <span class="bu">Error</span> Handling and <span class="fu">Robustness</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <p><strong>Resource Constraint Management</strong> - Enable
        <code>allowDiskUse</code> for large operations - Implement
        timeout handling - Design fallback strategies - Monitor memory
        usage patterns</p>
        <p><strong>Production Monitoring</strong> - Stage-by-stage
        performance tracking - Error rate monitoring - Data quality
        validation - Automated alerting systems</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="production-deployment-strategies">üöÄ Production
        Deployment Strategies</h1>
        <h1 id="production-deployment-strategies-1">üöÄ Production
        Deployment Strategies</h1>
        <h2 id="operational-excellence-for-analytics">Operational
        Excellence for Analytics</h2>
        <p><strong>Testing Framework</strong></p>
        <div class="sourceCode" id="cb44"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance validation pipeline</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> testPipeline <span class="op">=</span> [</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$sample</span><span class="op">:</span> {<span class="dt">size</span><span class="op">:</span> <span class="dv">10000</span>}}<span class="op">,</span>     <span class="co">// Representative sample</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$addFields</span><span class="op">:</span> {<span class="dt">testRun</span><span class="op">:</span> <span class="kw">true</span>}}<span class="op">,</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span>productionPipeline<span class="op">,</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$count</span><span class="op">:</span> <span class="st">&quot;processedDocs&quot;</span>}</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Benchmark execution</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> startTime <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> db<span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">aggregate</span>(testPipeline)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> duration <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>() <span class="op">-</span> startTime</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a># üöÄ Production Deployment <span class="fu">Strategies</span> (<span class="bu">Performance</span>)</span></code></pre></div>
        <p><strong>Deployment Process</strong> 1. <strong>Staging
        validation</strong> with production-like data 2.
        <strong>Performance baselines</strong> establishment 3.
        <strong>Gradual rollout</strong> with monitoring 4.
        <strong>Rollback procedures</strong> for issues</p>
        <p><strong>Capacity Planning</strong> - Memory usage projections
        - CPU utilization estimates - Storage growth planning - Network
        bandwidth requirements</p>
        <p><strong>Operational Monitoring</strong> - Real-time
        performance metrics - Resource utilization tracking - Error rate
        monitoring - Business impact measurement</p>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="performance-testing-framework">üìä Performance Testing
        Framework</h1>
        <h1 id="performance-testing-framework-1">üìä Performance Testing
        Framework</h1>
        <h2 id="systematic-optimization-validation">Systematic
        Optimization Validation</h2>
        <p><strong>Comprehensive Benchmarking</strong></p>
        <div class="sourceCode" id="cb45"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">// A/B testing framework</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> testConfigurations <span class="op">=</span> [</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Current Pipeline&quot;</span><span class="op">,</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pipeline</span><span class="op">:</span> currentPipeline<span class="op">,</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">expectedDuration</span><span class="op">:</span> <span class="dv">5000</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Optimized Pipeline&quot;</span><span class="op">,</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pipeline</span><span class="op">:</span> optimizedPipeline<span class="op">,</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">expectedDuration</span><span class="op">:</span> <span class="dv">2000</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>testConfigurations<span class="op">.</span><span class="fu">forEach</span>(config <span class="kw">=&gt;</span> {</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> result <span class="op">=</span> <span class="fu">benchmarkPipeline</span>(config<span class="op">.</span><span class="at">pipeline</span>)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`</span><span class="sc">${</span>config<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>result<span class="op">.</span><span class="at">duration</span><span class="sc">}</span><span class="vs">ms`</span>)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a># üìä <span class="bu">Performance</span> Testing <span class="fu">Framework</span> (<span class="bu">Performance</span>)</span></code></pre></div>
        <p><strong>Performance Metrics</strong> - Execution time per
        document - Memory usage patterns - CPU utilization rates - Index
        hit ratios - Network I/O measurements</p>
        <p><strong>Scalability Testing</strong> - Document volume
        scaling - Concurrent pipeline execution - Resource contention
        analysis - Breaking point identification</p>
        <p><strong>Regression Detection</strong> - Automated performance
        monitoring - Baseline comparison - Alert thresholds -
        Performance trend analysis</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="cross-platform-optimization">üåê Cross-Platform
        Optimization</h1>
        <h1 id="cross-platform-optimization-1">üåê Cross-Platform
        Optimization</h1>
        <h2
        id="multi-environment-performance-strategies">Multi-Environment
        Performance Strategies</h2>
        <p><strong>Hardware Optimization</strong></p>
        <div class="sourceCode" id="cb46"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">// CPU-optimized pipeline design</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$match</span><span class="op">:</span> {<span class="op">...</span>}}<span class="op">,</span>              <span class="co">// Index-optimized filtering</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$project</span><span class="op">:</span> {                  <span class="co">// Minimize data transfer</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">essentialField1</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">essentialField2</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  }}<span class="op">,</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$group</span><span class="op">:</span> {                    <span class="co">// CPU-efficient aggregation</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$category&quot;</span><span class="op">,</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">count</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}            <span class="co">// Simple accumulator</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  }}</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a># üåê Cross<span class="op">-</span>Platform <span class="fu">Optimization</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <p><strong>Environment-Specific Tuning</strong> - <strong>Cloud
        environments</strong>: Variable performance optimization -
        <strong>On-premise</strong>: Consistent resource utilization -
        <strong>Container deployments</strong>: Resource constraint
        handling - <strong>Edge computing</strong>: Limited resource
        strategies</p>
        <p><strong>MongoDB Configuration</strong> - Cache size
        optimization for aggregation workloads - Concurrency settings
        for pipeline execution - Memory allocation for blocking
        operations - Index building strategies</p>
        <p><strong>Multi-Region Considerations</strong> - Data locality
        optimization - Network latency management - Read preference
        strategies - Cross-region aggregation patterns</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="application-integration-patterns">üîó Application
        Integration Patterns</h1>
        <h1 id="application-integration-patterns-1">üîó Application
        Integration Patterns</h1>
        <h2 id="connecting-analytics-with-architecture">Connecting
        Analytics with Architecture</h2>
        <p><strong>Real-Time vs Batch Processing</strong></p>
        <div class="sourceCode" id="cb47"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Hybrid processing pattern</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AnalyticsService {</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Real-time for critical metrics</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getRealTimeMetrics</span>(userId) {</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> db<span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">$match</span><span class="op">:</span> {userId<span class="op">,</span> <span class="dt">timestamp</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">-</span> <span class="dv">3600000</span>)}}}<span class="op">,</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">$group</span><span class="op">:</span> {<span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$eventType&quot;</span><span class="op">,</span> <span class="dt">count</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}}}</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Batch for complex analytics</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">generateDailyReport</span>() {</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> db<span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">timestamp</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> startOfDay}}}<span class="op">,</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">$facet</span><span class="op">:</span> {</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">userMetrics</span><span class="op">:</span> [<span class="op">...</span>]<span class="op">,</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">revenueMetrics</span><span class="op">:</span> [<span class="op">...</span>]<span class="op">,</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">performanceMetrics</span><span class="op">:</span> [<span class="op">...</span>]</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>      }}</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a># üîó Application Integration <span class="fu">Patterns</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <p><strong>Caching Strategies</strong> - Result caching for
        expensive operations - Incremental updates for evolving datasets
        - Cache invalidation strategies - Memory-efficient caching
        patterns</p>
        <p><strong>API Design</strong> - Parameterized aggregation
        endpoints - Streaming for large result sets - Error handling for
        analytical operations - Rate limiting for resource-intensive
        queries</p>
        <p><strong>Event-Driven Analytics</strong> - Trigger-based
        pipeline execution - Real-time data processing - Streaming
        analytics integration - Event sourcing patterns</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="advanced-optimization-techniques">üèÜ Advanced
        Optimization Techniques</h1>
        <h1 id="advanced-optimization-techniques-1">üèÜ Advanced
        Optimization Techniques</h1>
        <h2 id="expert-level-performance-strategies">Expert-Level
        Performance Strategies</h2>
        <p><strong>Pipeline Compilation Understanding</strong></p>
        <div class="sourceCode" id="cb48"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Optimized pipeline structure</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Early filtering (index-optimized)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">status</span><span class="op">:</span> <span class="st">&quot;active&quot;</span><span class="op">,</span> <span class="dt">date</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> cutoffDate}}}<span class="op">,</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Memory-efficient transformation</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$project</span><span class="op">:</span> {<span class="dt">computedField</span><span class="op">:</span> {<span class="dt">$multiply</span><span class="op">:</span> [<span class="st">&quot;$price&quot;</span><span class="op">,</span> <span class="st">&quot;$quantity&quot;</span>]}}}<span class="op">,</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Late-stage aggregation</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$group</span><span class="op">:</span> {<span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$category&quot;</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$computedField&quot;</span>}}}</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span> {</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">hint</span><span class="op">:</span> {<span class="dt">status</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">date</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span>    <span class="co">// Index guidance</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">allowDiskUse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>            <span class="co">// Large dataset handling</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxTimeMS</span><span class="op">:</span> <span class="dv">30000</span>               <span class="co">// Timeout protection</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span> notes</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Key <span class="bu">Point</span><span class="op">:**</span> [Add speaker notes <span class="cf">for</span> <span class="kw">this</span> slide]</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Emphasis<span class="op">:**</span> [Add key talking points]</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="op">:::</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>SLIDE<span class="op">---</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a># üèÜ Advanced Optimization <span class="fu">Techniques</span> (Part <span class="dv">2</span>)</span></code></pre></div>
        <p><strong>Advanced Index Strategies</strong> - Covering indexes
        for pipeline stages - Partial indexes for filtered aggregations
        - Compound indexes spanning multiple stages - Index intersection
        optimization</p>
        <p><strong>Memory Pool Management</strong> - Pipeline
        segmentation for large operations - Resource sharing across
        concurrent pipelines - Memory allocation optimization - Garbage
        collection considerations</p>
        <p><strong>Parallel Processing Design</strong> - $facet
        parallelism utilization - Multi-collection processing -
        Distributed computing patterns - Load balancing strategies</p>
        <div class="notes">
        <p><strong>Key Point:</strong> [Add speaker notes for this
        slide]</p>
        <p><strong>Emphasis:</strong> [Add key talking points]</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="future-of-aggregation">üîÆ Future of Aggregation</h1>
        <h1 id="future-of-aggregation-1">üîÆ Future of Aggregation</h1>
        <h2 id="emerging-trends-and-opportunities">Emerging Trends and
        Opportunities</h2>
        <p><strong>Machine Learning Integration</strong></p>
        <div class="sourceCode" id="cb49"><pre
        class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ML-enhanced aggregation (conceptual)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">userBehavior</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">userId</span><span class="op">:</span> {<span class="dt">$in</span><span class="op">:</span> targetUsers}}}<span class="op">,</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$mlPredict</span><span class="op">:</span> {                    <span class="co">// Future ML operator</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> <span class="st">&quot;userChurnPrediction&quot;</span><span class="op">,</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">features</span><span class="op">:</span> [<span class="st">&quot;loginFrequency&quot;</span><span class="op">,</span> <span class="st">&quot;purchaseHistory&quot;</span>]<span class="op">,</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;churnProbability&quot;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  }}<span class="op">,</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$sort</span><span class="op">:</span> {<span class="dt">churnProbability</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>}}<span class="op">,</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">$limit</span><span class="op">:</span> <span class="dv">100</span>}</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
        <div class="notes">
        <p><strong>Memory Awareness:</strong> ‚ÄúEvery operator affects
        memory differently. Streaming vs blocking, accumulation vs
        filtering.‚Äù</p>
        <p><strong>Resource Planning:</strong> ‚ÄúDesign pipelines that
        stay within memory constraints while maximizing analytical
        power.‚Äù</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="future-of-aggregation-part-1">üîÆ Future of Aggregation
        (Part 1)</h1>
        <p><strong>Streaming Analytics Evolution</strong> - Real-time
        pipeline processing - Event stream integration - Low-latency
        analytical workflows - Continuous computation patterns</p>
        <p><strong>Columnar Processing</strong> - Column-oriented
        aggregation optimization - Analytical workload acceleration -
        Compression and encoding improvements - Vector processing
        capabilities</p>
        <p><strong>Edge Computing Analytics</strong> -
        Resource-constrained optimization - Distributed processing
        coordination - Network-aware pipeline design - Local computation
        strategies</p>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="future-of-aggregation-performance">üîÆ Future of
        Aggregation (Performance)</h1>
        <p><strong>Automated Optimization</strong> - AI-driven pipeline
        optimization - Performance prediction models - Automatic index
        recommendations - Self-tuning aggregation systems</p>
        <div class="notes">
        <p><strong>Continuation:</strong> This slide continues the
        content from the previous slide.</p>
        <p><strong>Key Focus:</strong> Maintain the same energy and
        emphasis from the previous section.</p>
        </div>
        <p>‚ÄîSLIDE‚Äî</p>
        <h1 id="complete-operator-reference-resources">üìö Complete
        Operator Reference &amp; Resources</h1>
        <h2 id="quick-reference-by-use-case">Quick Reference by Use
        Case</h2>
        <p><strong>Data Filtering:</strong> $match, $redact,
        $sample<br />
        <strong>Document Transformation:</strong> $project, $addFields,
        $set, $unset, $replaceRoot, $replaceWith<br />
        <strong>Array Processing:</strong> $unwind, $sortArray<br />
        <strong>Joining &amp; Lookups:</strong> $lookup, $graphLookup,
        $unionWith<br />
        <strong>Grouping &amp; Analysis:</strong> $group, $bucket,
        $bucketAuto, $count<br />
        <strong>Sorting &amp; Limiting:</strong> $sort, $limit, $skip,
        $topN, $bottomN, $firstN, $lastN<br />
        <strong>Multi-Pipeline:</strong> $facet<br />
        <strong>Window Functions:</strong> $setWindowFields, $densify,
        $fill<br />
        <strong>Geospatial:</strong> $geoNear<br />
        <strong>Text Search:</strong> $search, $searchMeta (Atlas)<br />
        <strong>Output Operations:</strong> $out, $merge</p>
        <h2 id="mongodb-documentation-links">MongoDB Documentation
        Links</h2>
        <ul>
        <li><a
        href="https://docs.mongodb.com/manual/reference/operator/aggregation/">Complete
        Aggregation Operators Reference</a></li>
        <li><a
        href="https://docs.mongodb.com/manual/core/aggregation-pipeline-optimization/">Aggregation
        Pipeline Optimization</a></li>
        <li><a
        href="https://docs.mongodb.com/manual/release-notes/">Version-Specific
        Release Notes</a></li>
        </ul>
        <p><strong>Master every operator. Optimize every pipeline. Scale
        every application.</strong> üöÄ</p>
        <div class="notes">
        <p><strong>Production Reality:</strong> ‚ÄúWhat works in
        development may not work in production. Plan for data quality
        issues, resource limits, and operational failures.‚Äù</p>
        <p><strong>Graceful Degradation:</strong> ‚ÄúBetter to get partial
        results than complete failure. Design for resilience.‚Äù</p>
        </div>
    </div>
    
    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        
        function showSlide(n) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach((slide, index) => {
                slide.style.display = index === n ? 'block' : 'none';
            });
            document.getElementById('slide-counter').textContent = n + 1;
            currentSlide = n;
        }
        
        function nextSlide() {
            const slides = document.querySelectorAll('.slide');
            if (currentSlide < slides.length - 1) {
                showSlide(currentSlide + 1);
            }
        }
        
        function previousSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
            }
        }
        
        function toggleNotes(button) {
            const notesContent = button.nextElementSibling;
            const isVisible = notesContent.classList.contains('show');
            
            if (isVisible) {
                notesContent.classList.remove('show');
                button.textContent = 'üìù Show Notes';
            } else {
                notesContent.classList.add('show');
                button.textContent = 'üìù Hide Notes';
            }
        }
        
        // Split content into slides and process notes
        function initializeSlides() {
            const container = document.getElementById('slides-container');
            const content = container.innerHTML;
            
            // Split by our custom slide separator (Pandoc converts ---SLIDE--- to <p>‚ÄîSLIDE‚Äî</p>)
            const slideParts = content.split(/<p>‚ÄîSLIDE‚Äî<\/p>/);
            const slides = [];
            
            slideParts.forEach((slideContent, index) => {
                if (slideContent.trim()) {
                    const slideDiv = document.createElement('div');
                    slideDiv.className = 'slide';
                    slideDiv.style.display = index === 0 ? 'block' : 'none';
                    
                    const slideContentDiv = document.createElement('div');
                    slideContentDiv.className = 'slide-content';
                    slideContentDiv.innerHTML = slideContent;
                    
                    slideDiv.appendChild(slideContentDiv);
                    slides.push(slideDiv);
                }
            });
            
            // Clear container and add slides
            container.innerHTML = '';
            slides.forEach(slide => container.appendChild(slide));
            
            // Process notes sections
            processNotesSections();
            
            // Initialize navigation with actual slide count
            window.totalSlides = slides.length;
            showSlide(0);
        }
        
        // Process notes sections after page load
        function processNotesSections() {
            const slides = document.querySelectorAll('.slide');
            slides.forEach((slide, slideIndex) => {
                // Find notes blocks (divs with class 'notes')
                const notesBlocks = slide.querySelectorAll('.notes');
                notesBlocks.forEach((notesBlock, notesIndex) => {
                    // Create expandable notes section
                    const notesSection = document.createElement('div');
                    notesSection.className = 'notes-section';
                    
                    const toggleButton = document.createElement('button');
                    toggleButton.className = 'notes-toggle';
                    toggleButton.textContent = 'üìù Show Notes';
                    toggleButton.onclick = function() { toggleNotes(this); };
                    
                    const notesContent = document.createElement('div');
                    notesContent.className = 'notes-content';
                    
                    const notesTitle = document.createElement('h4');
                    notesTitle.textContent = 'Speaker Notes';
                    
                    notesContent.appendChild(notesTitle);
                    notesContent.appendChild(notesBlock.cloneNode(true));
                    
                    notesSection.appendChild(toggleButton);
                    notesSection.appendChild(notesContent);
                    
                    // Replace the original notes block
                    notesBlock.parentNode.replaceChild(notesSection, notesBlock);
                });
            });
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                previousSlide();
            }
        });
        
        // Initialize slides after DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeSlides);
        // Also process immediately in case DOM is already loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSlides);
        } else {
            initializeSlides();
        }
    </script>
</body>
</html>
